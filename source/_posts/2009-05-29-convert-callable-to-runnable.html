--- 
name: convert-callable-to-runnable
layout: post
title: Convert a Callable to a Runnable
time: 2009-05-29 21:37:00 +01:00
---
Everytime I come accross it, it bugs me.<br /><br />The <span style="font-size:85%;"><span style="font-family:courier new;">Executors</span></span> class has helper methods to convert from a <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span> to a <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span>, presumably so you can submit an old school <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span> task to an exectuor, but I can never find the counterpart helper. Something to convert a <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span> to a <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span>.<br /><br />I seem to keep finding myself needing one and you might think me silly for doing so but it's because I'm into the habit of coding as <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span>s now. I tend to think of <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span> as simply something that can <span style="font-style: italic;">run</span>, not in terms of a <span style="font-size:85%;"><span style="font-family:courier new;">Thread</span></span> or concurrent task. I like the way I think about <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span>.<br /><br /><span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span> is like the new cool kid, with its funky return value and the ability to throw an exception. Wow, why did I ever bother with <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span> in the first place? <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span>, like <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span>, however is still just something that can be <span style="font-style: italic;">called</span>, it just so happens to fit in nicely with the executor framework and kind of looks all bling.<br /><br />I digress... back to jusitifying why I think I'm always needing to convert from <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span> to <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span>. As I say, if both interfaces represent something that can be called, I favour <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span> becuase its more powerful. I can return useful things and catch useful exceptions. I'm in the habit of using <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span>.<br /><br />Often then, I'll have utility classes, useful nuggets of functionality dressed up as a <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span>, and if I want to schedule them with an executor <span style="font-weight: bold; font-style: italic;">with a fixed delay or fixed rate</span>, I can't. The interface wants a <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span> and only a <span style="font-size:85%;"><span style="font-family:courier new;">Runnable</span></span>. Most likely becuase it doesn't really make much sense to schedule a fixed rate execution of a task that returns something when it would take quite some thinking to actually do something with the return value.<br /><br />None the less, I'd like to schedule something at a fixed rate (ignoring the result) that I also schedule elsewhere and actually do something with the result.<br /><br />Starting with the tests, any helper must delegate to the <span style="font-size:85%;"><span style="font-family:courier new;">Callable</span></span> and handle any exceptions.<br /><pre name="code" class="java:nogutter:nocontrols"><br />@RunWith(JMock.class)<br />public class CallableAdapterTest {<br />   private final Mockery context = new Mockery();<br />   private final Callable callable = context.mock(Callable.class);<br /><br />   private static final Object RESULT = new Object();<br /><br />   @Test<br />   public void delegates() throws Exception {<br />      callableWill(returnValue(RESULT));<br />      runnable(callable).run();<br />   }  <br /><br />   @Test(expected=RuntimeException.class)<br />   public void exceptionBubblesUp() throws Exception {<br />      callableWill(throwException(new Exception()));<br />      runnable(callable).run();<br />   }<br /> <br />   private void callableWill(final Action action) throws Exception {<br />      context.checking(new Expectations() {{<br />         one(callable).call(); will(action);<br />      }});<br />   }<br />}<br /></pre><br />To get a green light, the implementation is fairly trivial.<br /><pre name="code" class="java:nogutter:nocontrols"><br />public class CallableAdapter {<br /> <br />   public static Runnable runnable(final Callable callable) {<br />      return new Runnable() {<br />         @Override<br />         public void run()<br />            try<br />               callable.call();<br />            } catch (Exception e) {<br />               throw new RuntimeException(e);<br />            }<br />         }<br />      };<br />   }<br />}<br /></pre><br />Let me know if you've got any comments,  great ideas on the subject or can improve on the implementation above.<br /><br /><div style="text-align: center;"><blockquote><span style="font-weight:bold;">Update:</span> Since writing this entry, I created the<a href="http://code.google.com/p/tempus-fugit/"> tempus-fugit</a> project to capture these kinds of ideas.</blockquote></div><div><img src="http://4.bp.blogspot.com/_-uMxV_fCbC4/SVInGoVdYJI/AAAAAAAAC08/I4RV1KzCyPo/s320/gibble_22x22.png" alt="" id="BLOGGER_PHOTO_ID_5283328307719135378" style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer; width: 22px; height: 22px;" border="0" /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/20485368-1295889209896485927?l=pequenoperro.blogspot.com' alt='' /></div>
