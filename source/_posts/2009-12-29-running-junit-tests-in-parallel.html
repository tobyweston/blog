--- 
name: running-junit-tests-in-parallel
layout: post
title: Running JUnit tests in parallel
time: 2009-12-29 19:03:00 +00:00
---
I've been playing with running tests in their own threads for a while now (in particular with reference to <a href="http://pequenoperro.blogspot.com/2008/12/be-explicit-about-ui-thread-in-swt.html">GUI testing</a>) and am settling on a warm fuzzy feeling towards my general approach. I'm trying to capture this warm feeling more explicitly in the <a href="http://code.google.com/p/tempus-fugit/">tempus-fugit</a> project and today I was working on running tests in parallel with JUnit.<br /><br />Looking more into recent versions of JUnit, there seems to be lots and lots of integration points for you to play with. I've been playing with <span style=";font-family:courier new;font-size:85%;"  >Rule</span>s, <span style="font-size:85%;"><span style="font-family:courier new;">Statement</span></span>s and <span style="font-size:85%;"><span style="font-family:courier new;">Runner</span></span>s mostly and when creating your own <span style="font-size:85%;"><span style="font-family:courier new;">BlockJUnit4ClassRunner</span></span>, I spotted you can override the scheduler which, er, schedules the actual test methods to be run.<br /><br />After experimenting with much less straight forward integrations, overriding the scheduler gave the following.<br /><pre name="code" class="java:nogutter:nocontrols"><br />public class ConcurrentTestRunner extends BlockJUnit4ClassRunner {<br /><br />public ConcurrentTestRunner(Class type) throws Exception {<br />    super(type);<br />    setScheduler(new ConcurrentScheduler());<br />}<br /><br />private static class ConcurrentScheduler implements RunnerScheduler {<br /><br />    private ExecutorService executor;<br /><br />    public ConcurrentScheduler() {<br />        executor = newCachedThreadPool(new ThreadFactory() { ... });<br />    }<br /><br />    public void schedule(Runnable childStatement) {<br />        executor.submit(childStatement);<br />    }<br /><br />    public void finished() {<br />        shutdown(executor).waitingForCompletion(seconds(10));<br />    }<br />}<br />}<br /></pre>This results in all the test methods within a given class running in parallel. I'm excited about speeding up the execution time of my tests, next step would be run all tests across classes in parallel! hmmm.<br /><br />This is all available to use via the <a href="http://code.google.com/p/tempus-fugit/">tempus-fugit</a> project by the way. See the tempus-fugit <a href="http://tempus-fugit.googlecode.com/svn/site/documentation/concurrency.html#Parallel_Tests">documentation</a> for more details on the runner.<br /><div><br /><img src="http://4.bp.blogspot.com/_-uMxV_fCbC4/SVInGoVdYJI/AAAAAAAAC08/I4RV1KzCyPo/s320/gibble_22x22.png" alt="" id="BLOGGER_PHOTO_ID_5283328307719135378" style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer; width: 22px; height: 22px;" border="0" /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/20485368-6405873026468658862?l=pequenoperro.blogspot.com' alt='' /></div>
