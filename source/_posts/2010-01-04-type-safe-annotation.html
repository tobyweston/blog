--- 
name: type-safe-annotation
layout: post
title: Type Safe Annotation
time: 2010-01-04 20:51:00 +00:00
---
A new year and another Java gripe! This time its annotations and the lack of anything useful by way of parameters. Implementing the Goetz annotations from <a target="_blank"  href="http://www.amazon.com/Java-Concurrency-Practice-Brian-Goetz/dp/0321349601?ie=UTF8&tag=diyfiesta&link_code=btl&camp=213689&creative=392969">Concurrency In Practice</a><img src="http://www.assoc-amazon.com/e/ir?t=diyfiesta&l=btl&camp=213689&creative=392969&o=1&a=0321349601" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" />, I wanted to include an enum as a parameter type. Kind of like this<br /><pre name="code" class="java:nogutter:nocontrols">public @interface GuardedBy {<br />   Type value();<br /><br />   public enum Type { FIELD, CLASS; }<br />}</pre><br />So far so good. I then wanted to somehow parameterise the enum constants themselves to give extra information.<br /><pre name="code" class="java:nogutter:nocontrols">public @interface GuardedBy {<br />   Type value();<br /><br />   public enum Type {<br />      CLASS, FIELD;<br /><br />      public static Type FIELD(String field) {<br />         return FIELD;<br />      }<br /><br />      public static Type CLASS(String type) {<br />         return CLASS;<br />      }<br />   }<br />}</pre><br />Now, here's where the trouble began. Using the static constructor method is fine when I want to create an instance of a <span style="font-family: courier new;font-size:85%;" >Type</span> but not when I want to annotate some method. For example,<br /><pre name="code" class="java:nogutter:nocontrols">@GuardedBy(GuardedBy.Type.CLASS("more info")) // javac cries <br />public void foo() {<br />   GuardedBy.Type type = GuardedBy.Type.CLASS("more info"); // fine<br />}</pre><br />The compiler very quickly complains that the attribute value must be constant. Specifically,<br /><pre>an enum annotation value must be an enum constant</pre><br />To get round things, you can just create several attributes for the annotation. Rather than have a nice CLASS type which can optionally have a description, I was forced to have one attribute of type and another to capture the additional information. grrrr.<br /><pre name="code" class="java:nogutter:nocontrols">public @interface GuardedBy {<br />   Type value();<br />   String details() default "";<br /><br />   public enum Type { CLASS, FIELD; }<br />}</pre><br />Shame on you Java for leading me on a merry dance! I'd love to know more about why things are like this, so if you've got any more details, feel free to post a comment.<br /><div><br /><img src="http://4.bp.blogspot.com/_-uMxV_fCbC4/SVInGoVdYJI/AAAAAAAAC08/I4RV1KzCyPo/s320/gibble_22x22.png" alt="" id="BLOGGER_PHOTO_ID_5283328307719135378" style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer; width: 22px; height: 22px;" border="0" /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/20485368-8700079729981476480?l=pequenoperro.blogspot.com' alt='' /></div>
