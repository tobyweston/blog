--- 
name: isnotinstanceofsmell
layout: post
title: is(not(instanceOf(smell)));
time: 2009-07-29 19:17:00 +01:00
---
For some reason, common perception is that using <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span> is a bit of smell. I think its fallen in with a bad crowd and isn't really as bad as its cracked up to be.<br /><br />For example, given the following, what's clearer in the following exception handling code?<br /><pre name="code" class="java:nogutter:nocontrols"><br />try {<br /> ...<br />} catch (InvocationTargetException e) {<br /> if (RuntimeException.class.isAssignableFrom(e.getCause().getClass())) {<br />    throw new ApplicationException(...);<br /> }<br /> throw e.getCause();<br />}<br /></pre>or<br /><pre name="code" class="java:nogutter:nocontrols"><br />try {<br /> ...<br />} catch (InvocationTargetException e) {<br /> if (e.getCause() instanceof RuntimeException) {<br />    throw new ApplicationException(...)<br /> }<br /> throw e.getCause();<br />}<br /></pre>There seems very little difference in the semantics of the two calls, both handle class hierarchies and both handle interfaces. I think the legitimate use for <span style="font-size:85%;"><span style="font-family:courier new;">Class.isAssignableFrom</span></span> is around scenarios where reflective-type checks are more suited (for example, where the class to check against is only known or may change at runtime). Using <span style="font-size:85%;"><span style="font-family:courier new;">Class.isInstance</span></span> is a similar alternative. The other point that the <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#isAssignableFrom%28java.lang.Class%29">API documentation</a> points out is that <span style="font-size:85%;"><span style="font-family:courier new;">isAssignableFrom </span></span>works with primitives whereas <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span> can not.<br /><br />I wonder if the bad reputation <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span> suffers from is more due to often being seen in the company of strange conditional logic than anything else. The kind of stuff that seems to go against your Mumma's good advice. It may just have fallen in with a bad crowd but is itself a good kid at heart...<br /><br />I suspect <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span>, being around since forever, is seen as a bit antiquated but given the example above using <span style="font-size:85%;"><span style="font-family:courier new;">Class.isAssignableFrom</span></span> seems to just obfuscate things. The example needs to find out why a dynamic proxy throws an exception and because the <span style="font-size:85%;"><a style="font-family: courier new;" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/reflect/InvocationTargetException.html">InvocationTargetException</a></span> wraps  the underlying cause, it kind of breaks checked exception handling and it feels like we need to do some conditional check. If there is a smell here, that's it. The above is trying to hide the symptom of the smell (<span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span>) but the smell is still there, its just harder to see. I often catch similar whiffs when catching <span style="font-size:85%;"><a style="font-family: courier new;" href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutionException.html">ExecutionException</a></span>.<br /><br />More conventional cases where <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span> is a genuine smell may be around conditional logic making decisions based on class type where using polymrphism would be the obvious solution. It's this kind of thing that your Mumma warned you about and I suspect its this is the real smell that's rubbed off on poor downtrodden <span style="font-size:85%;"><span style="font-family:courier new;">instanceof</span></span>.<br /><br /><div><img src="http://4.bp.blogspot.com/_-uMxV_fCbC4/SVInGoVdYJI/AAAAAAAAC08/I4RV1KzCyPo/s320/gibble_22x22.png" alt="" id="BLOGGER_PHOTO_ID_5283328307719135378" style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer; width: 22px; height: 22px;" border="0" /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/20485368-4427345549525256045?l=pequenoperro.blogspot.com' alt='' /></div>
