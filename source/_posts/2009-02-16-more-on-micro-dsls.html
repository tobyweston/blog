--- 
name: more-on-micro-dsls
layout: post
title: More on Micro DSLs
time: 2009-02-16 20:06:00 +00:00
---
I was recently talking about what I call <a href="http://pequenoperro.blogspot.com/2009/01/be-more-expressive-with-builders.html">micro DSLs</a> and I thought I'd follow up with another example.<div><br /></div><div>So, another example of a micro DSL I found myself writing is one of finding some object within a collection of differently typed objects. In my example, I want to find a <span class="Apple-style-span"  style="font-family:'courier new';"><span class="Apple-style-span"  style="font-size:small;">Race</span></span> object inside a bunch of <span class="Apple-style-span"  style="font-size:small;">calendar</span> events objects, the finder micro DSL looks like this.</div><br /><pre name="code" class="java:nogutter:nocontrols">final class RaceFinder {<br /><br />private final Race race;<br /><br />   private RaceFinder(Race race) {<br />      this.race = race;<br />   }<br /><br />   static RaceFinder find(Race race) {<br />      return new RaceFinder(race);<br />   }<br /><br />   CalendarEventEntry in(List&lt;CalendarEventEntry&gt; events) {<br />      for (CalendarEventEntry event : events) {<br />         if (race.getName().equals(event.getTitle().getPlainText())) {<br />            return event;<br />         }<br />      }<br />      return null;<br />   }<br />}<br /></pre><div>The way the class is built, it forces the client to use it such.</div><div><br /></div><pre name="code" class="java:nogutter:nocontrols">CalendarEventEntry event = find(race).in(events);<br /></pre><br />Where <span class="Apple-style-span"  style="font-family:'courier new';"><span class="Apple-style-span"  style="font-size:small;">find</span></span> is statically imported and <span class="Apple-style-span"  style="font-family:'courier new';"><span class="Apple-style-span"  style="font-size:small;">race</span></span> and <span class="Apple-style-span"  style="font-family:'courier new';"><span class="Apple-style-span"  style="font-size:small;">events</span></span> have been pre-populated.<br /><br /><div>The original version had a method in the class to do the find, in the context of this class it was harder to test the find. I had a bunch of mocks and I was testing the find function amongst other behaviours of the class. The search line looked something like this.</div><pre name="code" class="java:nogutter:nocontrols">CalendarEventEntry event = searchForRaceIn(events);<br /></pre><br /><div><div>Why I term this a micro DSL is that it has a very specific usage (to find a race within a calendar) and it has a private constructor and public static construction method to ensure strict usage. The real thing though is the method names don't really do what they imply they're going to do. The 'in' method actually does the search, but the 'find' method doesn't do any such thing, it creates an object.<div><br /></div><div>How do you feel about this? When its used in a tiny domain like this and when it expresses the <span class="Apple-style-span" style="font-style: italic;">conversation</span> more concisely than the alternatives, I feel pretty good about it. It makes me realise its not the words (method names) that are important, its the sentences they put together. So I'm compromising on realistic method names for more expressive sentences. The fact that the class prevents you from constructing invalid sentences just makes the warm feeling grow.</div><div><br /></div><div><blockquote>Micro DSLs are recognisable by their tiny-domain, the way in which construction is done to ensure they can only be called in an order that makes sense to the domain and badly named methods.</blockquote><div><br /></div>Micro DSLs are starting to spread in my code like jam on toast but I know I have to check myself and really justify their use before I go mad. I also had fun trying to turn the finder above into a generified class which I'll talk about in my next post. I bet you can't wait, you lucky people.</div><div><br /></div><div><img src="http://4.bp.blogspot.com/_-uMxV_fCbC4/SVInGoVdYJI/AAAAAAAAC08/I4RV1KzCyPo/s320/gibble_22x22.png" alt="" id="BLOGGER_PHOTO_ID_5283328307719135378" style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer; width: 22px; height: 22px;" border="0" /></div><div><br /></div><div><br /></div></div></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/20485368-946339570073213011?l=pequenoperro.blogspot.com' alt='' /></div>
