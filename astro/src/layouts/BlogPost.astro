---
import type {CollectionEntry} from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import SiteLayout from '../components/ui/SiteLayout.astro';

type Props = CollectionEntry<'blog'>['data'];

const {title, description, keywords, pubDate, updatedDate}: Props = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const jsonLd = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "datePublished": pubDate?.toISOString(),
  ...(updatedDate && { "dateModified": updatedDate.toISOString() }),
  "url": canonicalURL,
  "author": {
    "@type": "Person",
    "name": "Toby Weston",
    "url": "https://baddotrobot.com"
  },
  "publisher": {
    "@type": "Person",
    "name": "bad.robot"
  }
});
---

<SiteLayout title={title} description={description} keywords={keywords}>
  <script type="application/ld+json" slot="head" is:inline set:html={jsonLd} />
  <div class="py-12">
    <article class="max-w-2xl mx-auto px-4">
      <div class="article-title-section mb-8">
        <p class="detail-kicker">Blog</p>
        <h1 class="article-title-section h1">{title}</h1>
        {description && <p class="article-description">{description}</p>}
      </div>

      <div class="article-meta">
        {pubDate && (
          <div class="article-date">
            <strong>Published:</strong> <FormattedDate date={pubDate} />
          </div>
        )}
        {updatedDate && (
          <div class="article-date">
            <strong>Updated:</strong> <FormattedDate date={updatedDate} />
          </div>
        )}
      </div>

      <div class="prose">
        <slot />
      </div>
    </article>
  </div>
</SiteLayout>
