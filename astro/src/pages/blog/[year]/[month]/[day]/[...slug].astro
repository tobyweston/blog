---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	const paths: any[] = [];

	posts.forEach((post) => {
		// Extract date from slug format: "2010-05-01-unmarshalling"
		const match = post.slug.match(/^(\d{4})-(\d{2})-(\d{2})-(.+)$/);
		if (match) {
			const [, year, month, day, rest] = match;
			paths.push({
				params: {
					year,
					month,
					day,
					slug: rest,
				},
				props: { newSlug: post.slug },
			});
		}
	});

	return paths;
}

interface Props {
	newSlug: string;
}

const { newSlug } = Astro.props as Props;
const redirectUrl = `/blog/${newSlug}/`;
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Redirecting...</title>
		<meta http-equiv="refresh" content={`0;url=${redirectUrl}`} />
		<link rel="canonical" href={redirectUrl} />
		<meta name="robots" content="noindex" />
	</head>
	<body>
		<p>
			Redirecting to <a href={redirectUrl}>{redirectUrl}</a>...
		</p>
		<script type="module" define:vars={{ redirectUrl }}>
			window.location.href = redirectUrl;
		</script>
	</body>
</html>
