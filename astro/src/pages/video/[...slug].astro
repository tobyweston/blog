---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import SiteLayout from '../../components/ui/SiteLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
  const videos = await getCollection('video');
  return videos.map((video) => ({
    params: { slug: video.slug },
    props: { video },
  }));
}

const { video } = Astro.props as { video: CollectionEntry<'video'> };
const { Content } = await video.render();
const embedUrl = `https://www.youtube-nocookie.com/embed/${video.data.youtubeId}?rel=0`;
---

<SiteLayout title={`${video.data.title} - Videos`} description={video.data.description}>
  <div class="py-12">
    <article class="max-w-4xl mx-auto px-4">
      <div class="article-title-section mb-8">
        <p class="detail-kicker">Video</p>
        <h1 class="article-title-section h1">{video.data.title}</h1>
        {video.data.description && (
          <p class="article-description">{video.data.description}</p>
        )}
      </div>

      <div class="article-meta">
        <div class="article-date">
          <strong>Published:</strong> <FormattedDate date={video.data.pubDate} />
        </div>
      </div>

      <div class="video-detail-frame">
        <iframe
          src={embedUrl}
          title={video.data.title}
          loading="lazy"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>

      <section class="prose mt-10">
        <Content />
      </section>
    </article>
  </div>
</SiteLayout>

<style>
  .video-detail-frame {
    position: relative;
    width: 100%;
    padding-top: 56.25%;
    background: #0f172a;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 2rem;
  }

  .video-detail-frame iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>

