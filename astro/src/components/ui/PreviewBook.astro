---
import FormattedDate from '../FormattedDate.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const { book } = Astro.props;
const detailHref = `/book/${book.slug}/`;

// Dynamically import image from the images folder if coverImage is specified
let coverImageImport;
if (book.data.coverImage) {
  try {
    const images = import.meta.glob<{ default: ImageMetadata }>('../../content/images/*.{jpeg,jpg,png,gif,webp}', { eager: true });
    const imagePath = `../../content/images/${book.data.coverImage}`;
    coverImageImport = images[imagePath]?.default;
  } catch (e) {
    console.warn(`Could not load image: ${book.data.coverImage}`);
  }
}
---

<article class="card book-preview">
  <a href={detailHref} class="book-preview-link card-item-reveal" data-item-idx="0" aria-label={`View ${book.data.title}`}>
    {coverImageImport && (
      <div class="book-preview-cover">
        <Image
          src={coverImageImport}
          alt={`${book.data.title} book cover`}
          loading="lazy"
        />
      </div>
    )}
  </a>
  <div class="book-preview-body">
    <div class="book-preview-meta">
      <h3 class="text-2xl font-semibold card-item-reveal" data-item-idx="1">{book.data.title}</h3>
      <div class="text-sm text-gray-500 font-medium card-item-reveal" data-item-idx="2">
        <FormattedDate date={book.data.pubDate} />
      </div>
    </div>
    <p class="text-gray-700 card-item-reveal" data-item-idx="3">{book.data.description}</p>
    <a href={detailHref} class="book-preview-cta card-item-reveal" data-item-idx="4">View Details</a>
  </div>
</article>

<style>
  .book-preview {
    padding: 0;
    overflow: hidden;
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1.5rem;
  }

  .book-preview-link {
    display: block;
    color: inherit;
  }

  .book-preview-cover {
    position: relative;
    width: 100%;
    max-width: 250px;
    padding: 1rem;
  }

  .book-preview-cover img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .book-preview-body {
    padding: 1.5rem;
    display: grid;
    gap: 0.75rem;
  }

  .book-preview-meta {
    display: grid;
    gap: 0.25rem;
  }

  .book-preview-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--accent);
    text-decoration: none;
  }

  .book-preview-cta:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .book-preview {
      grid-template-columns: 1fr;
    }

    .book-preview-cover {
      max-width: 100%;
      width: 100%;
    }
  }
</style>

