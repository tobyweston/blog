<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2009-12-24-flickering-tests/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Flickering Tests and a JUnit Rule</title><meta name="title" content="Flickering Tests and a JUnit Rule"><meta name="description" content="Automatically repeat intermittently failing tests using tempus-fugit's @Intermittent JUnit rule. Identify non-deterministic tests and make them deterministic."><meta name="keywords" content="intermittent tests, flickering tests, JUnit, non-deterministic tests, @Intermittent, tempus-fugit, test reliability"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2009-12-24-flickering-tests/"><meta property="og:title" content="Flickering Tests and a JUnit Rule"><meta property="og:description" content="Automatically repeat intermittently failing tests using tempus-fugit's @Intermittent JUnit rule. Identify non-deterministic tests and make them deterministic."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2009-12-24-flickering-tests/"><meta property="twitter:title" content="Flickering Tests and a JUnit Rule"><meta property="twitter:description" content="Automatically repeat intermittently failing tests using tempus-fugit's @Intermittent JUnit rule. Identify non-deterministic tests and make them deterministic."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Flickering Tests and a JUnit Rule","description":"Automatically repeat intermittently failing tests using tempus-fugit's @Intermittent JUnit rule. Identify non-deterministic tests and make them deterministic.","datePublished":"2009-12-24T00:00:00.000Z","url":"https://baddotrobot.com/blog/2009-12-24-flickering-tests/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.BIJT_GkW.css">
<link rel="stylesheet" href="/_astro/_slug_.CTb-p3zm.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Flickering Tests and a JUnit Rule</h1>  <p class="article-description">Automatically repeat intermittently failing tests using tempus-fugit&#39;s @Intermittent JUnit rule. Identify non-deterministic tests and make them deterministic.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2009-12-24T00:00:00.000Z"> Dec 24, 2009 </time> </div>  </div> <div class="prose">  <p>Occasionally I’ll see flickering tests. Sometimes they’re green, sometimes they’re red and this can happen without any code changes. What bugs me the most is that when trying to fix the problem, I can never be sure that I haven’t just been lucky and the green I’m seeing isn’t really a false positive. I’ll have to manually run the test several times before my confidence grows.</p>
<p>In an attempt to ease the situation, I created an <code>@Intermittent</code> annotation with a corresponding JUnit <code>Rule</code> and <code>Runner</code>. Now, I can mark up a suspect test and get JUnit to do the repetition. Joy.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Intermittent</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> flickering</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">   // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>You can then use the <code>IntermittentRule</code> to run the test method repeatedly.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> FlickeringTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Rule</span><span style="color:#F97583"> public</span><span style="color:#E1E4E8"> IntermittentRule rule </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IntermittentRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Intermittent</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> flickering</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Or use the <code>@RunWith</code> annotation to run the test using the <code>IntermittentTestRunner</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RunWith</span><span style="color:#E1E4E8">(IntermittentTestRunner.class)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> FlickeringTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Rule</span><span style="color:#F97583"> public</span><span style="color:#E1E4E8"> IntermittentRule rule </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IntermittentRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Intermittent</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> flickering</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>What’s interesting here is the way in which the <code>Rule</code> and <code>Runner</code> interact with
JUnit. Newer versions of JUnit have introduced the idea of <code>Rule</code>s and
<code>Statement</code>s. Using a <code>Rule</code> allows access to the underlying <code>Statement</code> which in
our case is the action to run the test method. So we’re able to run the
underlying statement again and again. Nice.</p>
<p>The <code>Runner</code> however can hook into JUnit’s framework in a different way. It can
access more than one statement and so can position itself slightly differently.
What this means for us is that when using the <code>Rule</code> above, any <code>@Before</code> or <code>@After</code>
methods will only be run once but the test method will run multiple times.
Using the <code>Runner</code> above however, will run any <code>@Before</code> or <code>@After</code> methods
once for each test repetition.</p>
<p>The code is available as part of the <a href="http://tempusfugitlibrary.org/">tempus-fugit</a> library, feel free to look around.</p>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>