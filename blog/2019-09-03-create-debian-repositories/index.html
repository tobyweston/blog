<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2019-09-03-create-debian-repositories/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Creating Debian Repositories</title><meta name="title" content="Creating Debian Repositories"><meta name="description" content="Step-by-step guide to building and publishing your own Debian/Ubuntu APT repository with aptly, including package publishing, signing with GPG, and client setup."><meta name="keywords" content="debian, ubuntu, apt, apt-get, aptly, deb repository, package repository, gpg signing, linux packaging, release distribution"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2019-09-03-create-debian-repositories/"><meta property="og:title" content="Creating Debian Repositories"><meta property="og:description" content="Step-by-step guide to building and publishing your own Debian/Ubuntu APT repository with aptly, including package publishing, signing with GPG, and client setup."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2019-09-03-create-debian-repositories/"><meta property="twitter:title" content="Creating Debian Repositories"><meta property="twitter:description" content="Step-by-step guide to building and publishing your own Debian/Ubuntu APT repository with aptly, including package publishing, signing with GPG, and client setup."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating Debian Repositories","description":"Step-by-step guide to building and publishing your own Debian/Ubuntu APT repository with aptly, including package publishing, signing with GPG, and client setup.","datePublished":"2019-09-03T00:00:00.000Z","url":"https://baddotrobot.com/blog/2019-09-03-create-debian-repositories/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.BIJT_GkW.css">
<link rel="stylesheet" href="/_astro/_slug_.CTb-p3zm.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Creating Debian Repositories</h1>  <p class="article-description">Step-by-step guide to building and publishing your own Debian/Ubuntu APT repository with aptly, including package publishing, signing with GPG, and client setup.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2019-09-03T00:00:00.000Z"> Sep 3, 2019 </time> </div>  </div> <div class="prose">  <p>In this post, we’ll look at to how to set up your own <a href="https://wiki.debian.org/DebianRepository">Debian repository</a> so users can install and upgrade your software via <code>apt-get</code> on popular Linux distros like Debian and Ubuntu.</p>
<h2 id="approach">Approach</h2>
<p>The basic approach:</p>
<ol>
<li>Create a <code>.deb</code> package (see the <a href="/blog/2019-09-02-deploy-java-to-debian/">previous post</a> for doing so with Java/Scala and <code>sbt</code>)</li>
<li>Use <code>aptly</code> to create a manage your own debian repository, serving your packages over HTTP</li>
<li>Tell your customers where your repository is hosted</li>
<li>Profit</li>
</ol>
<h3 id="debian-repositories">Debian Repositories</h3>
<p>Debian package archives or repositories are collections of packages in a standard file structure. They’re usually made available over the web so package managers like <code>apt</code> can retrieve and update systems. Debian has an official repository for itself but if you can’t get your software distributed as part of Linux, you can create and share your own repositories. The list of repositories used is usually configured in <code>/etc/sources.list</code>.</p>
<p>The <a href="https://wiki.debian.org/DebianRepository/Format">format</a> is a bit complicated but a bunch of files are required to tell package managers what versions of your software are available and where to download them from. Archives should also be cryptographically signed to prove that the software was publish by who they say they were.</p>
<p>So if you can create a folder structure that conforms, setup key files like <code>InRelease</code> / <code>Release</code> and <code>Pacakges</code> and ensure everything is singed, you can just host your own web server and configure your clients to point to it.</p>
<p>Initially, I tried creating everything manually as part of a deployment script (for example, you can create a <code>Pacakges</code> file using <code>dpkg-scanpackages</code>). I wanted to be able to create the repository across platforms and many of the tools weren’t available on MacOS. There where just <a href="https://github.com/tobyweston/temperature-machine/issues/84">too many problems</a> trying to do it manually. That’s where <code>aptly</code> comes it.</p>
<h2 id="aptly"><code>aptly</code></h2>
<p>The <a href="https://www.aptly.info/doc/configuration/"><code>aptly</code></a> software lets you create and manager repositories, add (otherwise known as <em>publishing</em>) your packages and even serving the repos over HTTP. <a href="https://www.aptly.info/download/">Download</a> the software or on MacOS just run <code>brew install aptly</code>).</p>
<p>Once setup, follow these steps.</p>
<ol>
<li>Create the repository</li>
<li>Add your application package to the repository</li>
<li>Publish your repository (this requires signing, so you’ll need <code>gpg</code> installed and a key generated)</li>
<li>Share your public key</li>
<li>Share your repository details</li>
</ol>
<h3 id="create-a-repository">Create a Repository</h3>
<p>Create a repository, lets call it <code>my-releases</code>. The <code>distribution</code> argument is <code>stretch</code>, <code>buster</code>, <code>stable</code> etc and will create a sub-folder using <code>dists</code> in the resulting repository. The <code>component</code> argument can be used to namespace your application, if you leave it blank, it will default to <code>main</code>. Again, you’ll see it in the generated folder structure.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ aptly repo create -distribution</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">stable</span><span style="color:#E1E4E8"> -component</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">my-application</span><span style="color:#B392F0"> my-releases</span></span></code></pre>
<h3 id="add-packages-to-the-repository">Add Packages to the Repository</h3>
<p>With your repo setup, you can start adding versions of your application.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ aptly repo add my-releases target</span></span></code></pre>
<p>Check the repository has some packages.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ aptly repo show -with-packages my-releases</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">Name: my-releases</span></span>
<span class="line"><span style="color:#79B8FF">Comment: </span></span>
<span class="line"><span style="color:#79B8FF">Default Distribution: </span></span>
<span class="line"><span style="color:#79B8FF">Default Component: main</span></span>
<span class="line"><span style="color:#79B8FF">Number of packages: 1</span></span>
<span class="line"><span style="color:#79B8FF">Packages:</span></span>
<span class="line"><span style="color:#79B8FF">  my-application_2.1_all</span></span>
<span class="line"><span style="color:#79B8FF">  my-application_2.2_all</span></span>
<span class="line"><span style="color:#79B8FF">  my-application_2.3_all</span></span></code></pre>
<h3 id="publish-the-repository">Publish the Repository</h3>
<p>Publishing in <code>aptly</code> takes your repository, all the packages it contains and creates the repository folder structure locally, digitally signing all the artifacts. By default, it will output to <code>~/.aptly/public</code>.</p>
<p>You’ll need <code>gpg</code> to sign, so if you don’t have it setup, install and create a new key.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ brew install gnupg</span></span>
<span class="line"><span style="color:#E1E4E8">$ gpg --full-generate-key</span></span></code></pre>
<p>If you have more than one key, <code>aptly</code> may not use the one you’re expecting to sign. Make sure you use the <code>-gpg-key=???</code> flag for <code>aptly</code> commands.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ aptly -distribution</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">stable</span><span style="color:#E1E4E8"> -architectures</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">armhf</span><span style="color:#B392F0"> -force-overwrite</span><span style="color:#79B8FF"> -gpg-key=00258F4822661</span><span style="color:#79B8FF"> -passphrase=</span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF">secret</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> \</span></span>
<span class="line"><span style="color:#79B8FF">               publish repo my-releases</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">Loading packages...</span></span>
<span class="line"><span style="color:#79B8FF">Generating metadata files and linking package files...</span></span>
<span class="line"><span style="color:#79B8FF">Finalizing metadata files...</span></span>
<span class="line"><span style="color:#79B8FF">Signing file 'Release' with gpg, please enter your passphrase when prompted:</span></span>
<span class="line"><span style="color:#79B8FF">Clearsigning file 'Release' with gpg, please enter your passphrase when prompted:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">Local repo my-releases has been successfully published.</span></span>
<span class="line"><span style="color:#79B8FF">Please setup your webserver to serve directory '/Users/toby/.aptly/public' with autoindexing.</span></span>
<span class="line"><span style="color:#79B8FF">Now you can add following line to apt sources:</span></span>
<span class="line"><span style="color:#79B8FF">  deb http://your-server/ stable main</span></span>
<span class="line"><span style="color:#79B8FF">Dont forget to add your GPG key to apt with apt-key.</span></span></code></pre>
<p>When you want to update the repository with a new version of your software, you use <code>publish update</code> rather than the initialising <code>publish</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ aptly -architectures</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">armhf</span><span style="color:#B392F0"> -force-overwrite</span><span style="color:#79B8FF"> -gpg-key=00258F48226612AE</span><span style="color:#79B8FF"> -passphrase=</span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF">secret</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> \</span></span>
<span class="line"><span style="color:#79B8FF">            publish update stable</span></span></code></pre>
<h3 id="share-your-gpg-key">Share your GPG Key</h3>
<p>For users to download your packages without problems, you need to share the key you generated earlier. You do this by uploading to a know <a href="https://debian-administration.org/article/451/Submitting_your_GPG_key_to_a_keyserver">key server</a>.</p>
<p>Check your secret keys with:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ gpg --list-secret-keys</span></span></code></pre>
<p>…then upload with the following using the key hash from the previous command..</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ gpg --send-keys 00258F48226612AE</span></span></code></pre>
<p>If you have problems, you can also upload manually via the website <a href="http://pool.sks-keyservers.net/#submit">http://pool.sks-keyservers.net/#submit</a> having exported the key with the following:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ gpg --armor --export 00258F48226612AE</span></span></code></pre>
<p>Check it’s available publicly by <a href="http://pool.sks-keyservers.net/">searching for it</a> by email or full ID (prefixed with <code>0x</code>.</p>
<h2 id="users-setup-apt">Users Setup <code>apt</code></h2>
<p>Users have to add an entry in <code>/etc/sources.list</code> to point to the new repository. For example,</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#79B8FF">deb http://robotooling.com/debian/ stable temperature-machine</span></span></code></pre>
<p>and then manually import the appropriate key (which on the Raspberry Pi, requires sudo)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="console"><code><span class="line"><span style="color:#E1E4E8">$ sudo apt-key adv --keyserver pool.sks-keyservers.net --recv-keys 00258F48226612AE</span></span></code></pre>
<p>From that point on, users can run <code>sudo apt-get update</code> to index the files and install and upgrade via <code>apt-get install</code>.</p>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>