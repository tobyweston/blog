<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2010-10-18-logging-is-evil-but/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Logging is evil but...</title><meta name="title" content="Logging is evil but..."><meta name="description" content="Logging clutters code and couples concerns. Learn how to treat logging as a feature, separate it from business logic, and write tests that assert on log output."><meta name="keywords" content="logging, log4j, testing logging, separation of concerns, logging as feature, assertions on logs"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2010-10-18-logging-is-evil-but/"><meta property="og:title" content="Logging is evil but..."><meta property="og:description" content="Logging clutters code and couples concerns. Learn how to treat logging as a feature, separate it from business logic, and write tests that assert on log output."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2010-10-18-logging-is-evil-but/"><meta property="twitter:title" content="Logging is evil but..."><meta property="twitter:description" content="Logging clutters code and couples concerns. Learn how to treat logging as a feature, separate it from business logic, and write tests that assert on log output."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Logging is evil but...","description":"Logging clutters code and couples concerns. Learn how to treat logging as a feature, separate it from business logic, and write tests that assert on log output.","datePublished":"2010-10-18T00:00:00.000Z","url":"https://baddotrobot.com/blog/2010-10-18-logging-is-evil-but/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.CzF6U4o9.css">
<link rel="stylesheet" href="/_astro/_slug_.DbZHOt6G.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <!--{heroImage && (--> <!--  <div class="hero-image mb-8">--> <!--    <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-lg" />--> <!--  </div>--> <!--)}--> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Logging is evil but...</h1>  <p class="article-description">Logging clutters code and couples concerns. Learn how to treat logging as a feature, separate it from business logic, and write tests that assert on log output.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2010-10-18T00:00:00.000Z"> Oct 18, 2010 </time> </div>  </div> <div class="prose">  <p>Logging is a nightmare. I don’t mean here that conveying information about exceptional circumstances is a nightmare, I mean the combination of over eager developers and [<em>insert your current logging framework here</em>] is a recipe for disaster. We’ve all seen too much of</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">Logger log </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Logger.</span><span style="color:#B392F0">getLogger</span><span style="color:#E1E4E8">(ThisSucks.class);</span></span>
<span class="line"><span style="color:#E1E4E8">...</span></span>
<span class="line"><span style="color:#F97583">try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    somethingRisky</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (SomethingVeryBadException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">   log.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(e);</span></span>
<span class="line"><span style="color:#F97583">   throw</span><span style="color:#E1E4E8"> e;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>which is just one example where the exception handling policy for the system (it’s a system-wide concern remember) is muddled at best. Nothing is saying that the same exception isn’t logged elsewhere or that the exception is even handled correctly or the right people notified. It’s not ok to just log and rethrow and every single time we go to declare a new logger, we should think twice.</p>
<p>We’ve taken this very literally in my current project and everyone is actively discouraged from instantiating a logger. I’d rather be explicit that some exception event has occurred and fire an event that some interested party can listen for. This makes perfect sense when you think about the huge log files that someone has to trawl through, armed only with for some vague clue as to what went wrong, a grep manual and the futile hope that developers actually log something useful. All without the context of the code to actually guide them. Good luck.</p>
<p>The disseminated log problem is exacerbated if there is no clear audit trail tying pieces of information together. In a system with thousands of request per second, how do you tie the logged request inputs to some stack trace embedded in the middle of another thousand requests? What’s the correlation ID? What should have been a clear set of requirements from the business (in this case, presumably the support team), can easily get lost in the technical translation.</p>
<blockquote>
<p>Logging is evil, but if you really <em>have</em> to, be honest about it…</p>
</blockquote>
<p>Asking the business <em>“what information do you want to see in the event of x happening”</em> rather than assuming they want to see some stack trace in a huge log can make a lot of sense. We’re often not logging for ourselves (we have debuggers for that), we’re often logging for our customers. If we start to think about this stuff early, in terms of exception events and their audience, we can build systems that tell the outside world something meaningful in flexible ways. We start to define a system wide exception handling policy rather than relying of the default exception handler (<code>System.out</code> is rarely the right choice!).</p>
<p>So back to my current project. Logging is evil, but if I really <em>have</em> to log, my saving grace is to be explicit about it. I’ll hunt down a customer and I’ll write a test to advertise the fact the log contains what they asked for.</p>
<h2 id="separating-concerns">Separating Concerns</h2>
<p>Most of the common logging frameworks make it troublesome to inject a logger instance (for testing). Logging (or preferably, firing an event) should be orthogonal to the classes core behaviour. My preferred approach is the canonical example of using Aspects, or less esoterically, using decorators.</p>
<p>For example, I created a interface <code>Post</code>, to handle HTTP POST requests. Why should I add logging to implementations and open the door to ad-hoc, erratic logging? I shouldn’t, but when my implementation <code>CustomerPost</code> requires logging of the request and response, I can decorate with a <code>LoggingPost</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> LoggingPost</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> Post</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Logger LOG </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Logger.</span><span style="color:#B392F0">getLogger</span><span style="color:#E1E4E8">(Post.class);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> LoggingPost</span><span style="color:#E1E4E8">(Post </span><span style="color:#FFAB70">delegate</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.delegate </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> delegate;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Response </span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(Body </span><span style="color:#FFAB70">body</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">       try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">           return</span><span style="color:#E1E4E8"> delegate.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(body);</span></span>
<span class="line"><span style="color:#E1E4E8">       } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (IOException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">           LOG.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(e.</span><span style="color:#B392F0">getMessage</span><span style="color:#E1E4E8">(), e);</span></span>
<span class="line"><span style="color:#F97583">           throw</span><span style="color:#E1E4E8"> e;</span></span>
<span class="line"><span style="color:#E1E4E8">       }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>You might be concerned that the try/catch above looks very similar to the original negative example. The good thing about our decorated example above is that by being explicit about this classes responsibility, declaring the usage in the correct context, we can actually define the system wide policy for logging the <code>Post</code> calls in one place, without affecting the contract of the interface. We’d do this for example, on the system boundary, for example where the RESTful API is implemented.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Resource</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CustomerServlet</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> doPost</span><span style="color:#E1E4E8">(Request </span><span style="color:#FFAB70">chuck</span><span style="color:#E1E4E8">, Response </span><span style="color:#FFAB70">up</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        ...</span></span>
<span class="line"><span style="color:#E1E4E8">        customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> LoggingPost</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> CustomerPost</span><span style="color:#E1E4E8">(...));</span></span>
<span class="line"><span style="color:#E1E4E8">        customer.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(...)</span></span>
<span class="line"><span style="color:#E1E4E8">        ...</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="testing-the-logger">Testing the Logger</h2>
<p>In our <code>LoggingPost</code> above, we haven’t even tried to inject a logger in to make the testing easier. Instead, mostly because I was being lazy, I used the helper class below. This is intended to represent Log4J in the context of a test and give access to the logger for assertion purposes.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Log4J</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> StringWriter writer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> StringWriter</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Logger logger;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String uuid </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> UUID.</span><span style="color:#B392F0">randomUUID</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> Log4J </span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">(Logger </span><span style="color:#FFAB70">logger</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Log4J</span><span style="color:#E1E4E8">(logger);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#B392F0"> Log4J</span><span style="color:#E1E4E8">(Logger </span><span style="color:#FFAB70">logger</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.logger </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> logger;</span></span>
<span class="line"><span style="color:#E1E4E8">        WriterAppender appender </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WriterAppender</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> SimpleLayout</span><span style="color:#E1E4E8">(), writer);</span></span>
<span class="line"><span style="color:#E1E4E8">        appender.</span><span style="color:#B392F0">setName</span><span style="color:#E1E4E8">(uuid);</span></span>
<span class="line"><span style="color:#E1E4E8">        logger.</span><span style="color:#B392F0">addAppender</span><span style="color:#E1E4E8">(appender);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> clean</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        logger.</span><span style="color:#B392F0">removeAppender</span><span style="color:#E1E4E8">(uuid);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> assertThat</span><span style="color:#E1E4E8">(Matcher&#x3C;</span><span style="color:#F97583">String</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">matcher</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        org.junit.Assert.</span><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(writer.</span><span style="color:#B392F0">toString</span><span style="color:#E1E4E8">(), matcher);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Using it in the test for <code>LoggingPost</code> is shown below</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RunWith</span><span style="color:#E1E4E8">(JMock.class)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> LoggingPostTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Mockery context </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Mockery</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Post mock </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> context.</span><span style="color:#B392F0">mock</span><span style="color:#E1E4E8">(Post.class);</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Log4J logger </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Log4J.</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">(Logger.</span><span style="color:#B392F0">getLogger</span><span style="color:#E1E4E8">(Post.class));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String EXCEPTION_MESSAGE </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "bar bar black sheep..."</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> shouldDelegate</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8">        context.</span><span style="color:#B392F0">checking</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Expectations</span><span style="color:#E1E4E8">() {{</span></span>
<span class="line"><span style="color:#B392F0">            one</span><span style="color:#E1E4E8">(mock).</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(...);</span></span>
<span class="line"><span style="color:#E1E4E8">        }});</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#B392F0"> LoggingPost</span><span style="color:#E1E4E8">(mock).</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(...);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> shouldLogWhenExceptionIsThrown</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">            postWill</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">throwException</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> IOException</span><span style="color:#E1E4E8">(EXCEPTION_MESSAGE)));</span></span>
<span class="line"><span style="color:#F97583">            new</span><span style="color:#B392F0"> LoggingPost</span><span style="color:#E1E4E8">(mock).</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(...);</span></span>
<span class="line"><span style="color:#B392F0">            fail</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (IOException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            logger.</span><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">allOf</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">containsString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"ERROR"</span><span style="color:#E1E4E8">), </span><span style="color:#B392F0">containsString</span><span style="color:#E1E4E8">(EXCEPTION_MESSAGE)));</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">After</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> cleanupLogger</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        logger.</span><span style="color:#B392F0">clean</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> postWill</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">final</span><span style="color:#E1E4E8"> Action </span><span style="color:#FFAB70">action</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        context.</span><span style="color:#B392F0">checking</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Expectations</span><span style="color:#E1E4E8">(){{</span></span>
<span class="line"><span style="color:#B392F0">            allowing</span><span style="color:#E1E4E8">(mock); </span><span style="color:#B392F0">will</span><span style="color:#E1E4E8">(action);</span></span>
<span class="line"><span style="color:#E1E4E8">        }});</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>It relies on Log4J’s static instances to dynamically add a logger to the list of loggers and thereby appending any generated logs to something that the <code>Log4J</code> test helper can check against. I can’t decide if I like this or not. It gives you an extra test that your class under test is using a logger with the name that you expect (<code>"Post.class"</code> in the example above), testing your logger configuration as a by-product.</p>
<p>What I found interesting about this though was that it was always seemed a lot of effort making some logging framework play nicely with mocks, or writing and configuring a custom in memory appender and asserting on it. With the above example, I very quickly added confirmation to existing Log4J infrastructure.</p>
<p>I’d love to hear your comments and how you write tests for logging.</p>
<p>PS. Logging really is evil.</p>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>