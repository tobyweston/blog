<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1PVLDLDJQN"></script><script>(function(){const gaId = "G-1PVLDLDJQN";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    })();</script><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2012-03-27-expecting-exception-with-junit-rule/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Expecting Exceptions JUnit Rule</title><meta name="title" content="Expecting Exceptions JUnit Rule"><meta name="description" content="Replace the try-fail-catch anti-pattern with JUnit's ExpectedException rule for cleaner, more readable exception testing."><meta name="keywords" content="JUnit, ExpectedException, @Rule, testing exceptions, try-catch, JUnit rule, exception testing"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2012-03-27-expecting-exception-with-junit-rule/"><meta property="og:title" content="Expecting Exceptions JUnit Rule"><meta property="og:description" content="Replace the try-fail-catch anti-pattern with JUnit's ExpectedException rule for cleaner, more readable exception testing."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2012-03-27-expecting-exception-with-junit-rule/"><meta property="twitter:title" content="Expecting Exceptions JUnit Rule"><meta property="twitter:description" content="Replace the try-fail-catch anti-pattern with JUnit's ExpectedException rule for cleaner, more readable exception testing."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Expecting Exceptions JUnit Rule","description":"Replace the try-fail-catch anti-pattern with JUnit's ExpectedException rule for cleaner, more readable exception testing.","datePublished":"2012-03-27T00:00:00.000Z","url":"https://baddotrobot.com/blog/2012-03-27-expecting-exception-with-junit-rule/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.CzF6U4o9.css">
<link rel="stylesheet" href="/_astro/_slug_.DbZHOt6G.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <!--{heroImage && (--> <!--  <div class="hero-image mb-8">--> <!--    <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-lg" />--> <!--  </div>--> <!--)}--> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Expecting Exceptions JUnit Rule</h1>  <p class="article-description">Replace the try-fail-catch anti-pattern with JUnit&#39;s ExpectedException rule for cleaner, more readable exception testing.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2012-03-27T00:00:00.000Z"> Mar 27, 2012 </time> </div>  </div> <div class="prose">  <p>To make an assertion that an exception was thrown with JUnit, it’s fairly common to use the try/fail/catch idiom or
the <code>expected</code> element of the <code>@Test</code> annotation. Despite being more concise than the former,
there is an argument that using <code>expected</code> doesn’t support all the cases you may want to test. The example being
to perform additional testing after the exception or testing against the actual exception message.</p>
<p>JUnit 4.7 introduces the next progression, a <code>@Rule</code> that offers the best of both worlds. This articles weighs up the pros and cons of each approach and takes a closer look at the syntax of each.</p>
<h2 id="the-tryfailcatch-idiom">The try/fail/catch Idiom</h2>
<p>The typical pattern is to catch an exception or fail explicitly if it was never thrown.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> example1</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        find</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"something"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        fail</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (NotFoundException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">        assertThat</span><span style="color:#E1E4E8">(e.</span><span style="color:#B392F0">getMessage</span><span style="color:#E1E4E8">(), </span><span style="color:#B392F0">containsString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"could not find something"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // ... could have more assertions here</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>which would highlight a failure in the following way.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>java.lang.AssertionError: expected an exception</span></span>
<span class="line"><span>	at org.junit.Assert.fail(Assert.java:91)</span></span>
<span class="line"><span>	at bad.roboot.example.ExceptionTest.example1(ExceptionTest.java:20)</span></span>
<span class="line"><span>	...</span></span></code></pre>
<p>The idiom has potential advantages in that it offers the opportunity to assert against the actual exception as well as performing additional work after the expectation. Aside from the noise, the major drawback however is that its very easy to forget to include the <code>fail</code> call. If genuinely doing test first, where we always run the test red, this wouldn’t be a problem but all too often things slip through the net. In practice, I’ve seen far too many examples with a missing <code>fail</code> giving false positives.</p>
<h2 id="test-expected--exceptionclass">@Test (expected = Exception.class)</h2>
<p>Using the <code>expected</code> element, we can rewrite the test as follows.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span><span style="color:#E1E4E8"> (expected </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> NotFoundException.class)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> example2</span><span style="color:#E1E4E8">() throws NotFoundException {</span></span>
<span class="line"><span style="color:#B392F0">    find</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"something"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">    // ... this line will never be reached when the test is passing</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>which will result in the following failure.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>java.lang.AssertionError: Expected exception: bad.robot.example.NotFoundException</span></span></code></pre>
<p>Much more concise, we’ve done away with all the noise at the cost of not being able to assert against the exception
message. We’ve also lost the ability to make more assertions after <code>find</code>. However, you might decide that smaller focused tests are in fact a good thing. Using this syntax, we’re lead into writing a test focused on just one thing; that an exception is thrown when we call <code>find</code>.</p>
<p>The test feedback has also become clearer.</p>
<h2 id="expectedexception-rule">ExpectedException Rule</h2>
<p>Using an instance of <code>ExpectedException</code>, we can define a <a href="http://www.infoq.com/news/2009/07/junit-4.7-rules">JUnit rule</a>
that allows us to setup expectations that are checked after the test concludes. It has a similar feel to
setting up expectations in mocking frameworks like <a href="http://www.jmock.org">JMock</a>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Rule</span><span style="color:#F97583"> public</span><span style="color:#E1E4E8"> ExpectedException exception </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ExpectedException.</span><span style="color:#B392F0">none</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> example3</span><span style="color:#E1E4E8">() throws NotFoundException {</span></span>
<span class="line"><span style="color:#E1E4E8">    exception.</span><span style="color:#B392F0">expect</span><span style="color:#E1E4E8">(NotFoundException.class);</span></span>
<span class="line"><span style="color:#E1E4E8">    exception.</span><span style="color:#B392F0">expectMessage</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">containsString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"exception message"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#B392F0">    find</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"something"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">    // ... this line will never be reached when the test is passing</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Which would show the failure below.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>java.lang.AssertionError: Expected test to throw (exception with message a string containing "exception message" and an instance of bad.robot.example.NotFoundException)</span></span>
<span class="line"><span>	at org.junit.rules.ExpectedException$ExpectedExceptionStatement.evaluate(ExpectedException.java:118)</span></span>
<span class="line"><span>	...</span></span></code></pre>
<p>The rule allows us to assert the exception is thrown and make assertions against the message. We still can’t make
additional assertions after the <code>find</code> method call, but this may not be a bad thing.</p>
<h2 id="beware-combining-rules-with-runwith">Beware combining Rules with @RunWith</h2>
<p>Beware though that if you combine the rule with certain <code>@RunWith</code> classes,
you may get a false positive. Specifically, if you were to run with a class that extends <code>JUnit4ClassRunner</code> in the
above example, the test would no longer fail. You’d get a false positive.</p>
<p>For example, if you’re using a version of JMock prior to 2.6.0 and use <code>@RunWith(JMock.class)</code> you’ll encounter this. Older versions of the <code>JMock.class</code> extend <code>JUnit4ClassRunner</code> and <code>JUnit4ClassRunner</code> ignores rules. The newer <code>BlockJUnit4ClassRunner</code> supports rules and JMock post 2.6.0 extends this class in <code>JMock.class</code>.</p>
<h2 id="summary">Summary</h2>
<p>The new rule offers a balance between concise syntax and function. In practice though if you’re not interested in asserting against the exception’s message, the <code>expected</code> element offers the most straight forward syntax. In the next article <a href="/blog/2012-03-28-exception-handling-as-a-system-wide-concern/">Exception Handling as a System Wide Concern</a>, I describe a general exception handling approach which negates the need to assert against exception messages.</p>
<p>The <code>ExpectedException</code> rule comes with its own baggage. The declarative nature of the rule means <em>magic</em> just happens and so there is a new kind of “noise” to cope with in the test. You may or may not be comfortable with this.</p>
<p>I’d love to hear which approach you prefer, so feel free to post a comment below.</p>
<h2 id="recommended-reading">Recommended Reading</h2>
<ul>
<li><a href="http://www.amazon.co.uk/gp/product/0974514012/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=0974514012&#x26;linkCode=as2&#x26;tag=baddotrobot-21">Pragmatic Unit Testing in Java with Junit (Pragmatic Programmers)</a>, Andy Hunt, Dave Thomas</li>
<li><a href="http://www.amazon.co.uk/gp/product/0321503627/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=0321503627&#x26;linkCode=as2&#x26;tag=baddotrobot-21">Growing Object-Oriented Software, Guided by Tests</a>, Steve Freeman, Nat Pryce</li>
<li><a href="http://www.amazon.co.uk/gp/product/1932394850/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=1932394850&#x26;linkCode=as2&#x26;tag=baddotrobot-21">Test Driven: TDD and Acceptance TDD for Java Developers</a>, Lasse Koskela</li>
</ul>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>