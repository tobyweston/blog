
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>bad.robot</title>
  <meta name="author" content="Toby Weston">

  
  <meta name="description" content="It&#8217;s objective setting time for the guys at work. Aligning what&#8217;s really good for you with what&#8217;s good for the company shouldn&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://baddotrobot.com/blog/page/5/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="bad.robot" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Averia+Libre:300' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

<!-- Load jQuery -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    jQuery.noConflict(); // ender.js conflicts with jQuery
</script>

<!-- Load FancyBox -->
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" />
<script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

<!-- Fix FancyBox style for OctoPress -->
<style type="text/css">
  .fancybox-wrap { position: fixed !important; }
  .fancybox-opened {
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
  }
  .fancybox-close, .fancybox-prev span, .fancybox-next span {
    background-color: transparent !important;
    border: 0 !important;
  }
</style>


<!-- Custom Scripts -->
<script language="Javascript" type="text/javascript">
    // ender.js gobbles jQuery's ready event: Use ender.js $ instead
    $(document).ready(function() {
        jQuery(".fancybox").fancybox({

            openEffect	: 'none',
            closeEffect	: 'none',

            helpers : {
                title: {
                    type: 'float'
                }
            }
        });
    });
</script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3327317-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
    <!-- last update; 2013-05-24 14:21:01 +0100 -->
    <h1><a href="/"><font color="#C7DEBC">bad</font><font color="#C8CDCB">.robot</font></a></h1>
    
    <h2>good robots do what they're told</h2>
    
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:baddotrobot.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/code">Code</a></li>
  <li><a href="/book">Book</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/06/17/objectives/">Objectives</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-06-17T00:00:00+01:00" pubdate data-updated="true">Jun 17<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s objective setting time for the guys at work. Aligning what&#8217;s really good for you with what&#8217;s good for the company shouldn&#8217;t be difficult, right? Your generally heading in the same direction and have similar interests at heart. Why then do we end up with generic meaningless objectives like &#8220;attend a XXX course&#8221;? I think you can get the most out of the objective setting exercise by thinking about what you want <em>personally</em> out of your career, don&#8217;t settle for the bland, phrase your objectives so there is real value in them. So, if the company think of them in terms of</p>

<blockquote><p>S.M.A.R.T</p></blockquote>

<p>I like the think of them as</p>

<blockquote><p>S.M.A.R.T.Y</p></blockquote>

<p>Where the Y is all about <strong>YOU</strong>; make it personal.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/06/17/objectives/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/05/01/unmarshalling/">Un/Marshalling</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-05-01T00:00:00+01:00" pubdate data-updated="true">May 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post should probably be titled &#8220;Why I don&#8217;t like Unmarhsalling frameworks&#8221;. They just hack me off. I mean really,
who wants to have to use the Java objects that they make you use? It&#8217;s not that they don&#8217;t represent as objects the data that the frameworks unmarshall, they do. It&#8217;s more that the underlying data may or may not match your systems view of the domain. I don&#8217;t want to have to run some process to generate <code>Foo.java</code> only to convert it to <code>MyFoo.java</code>, I&#8217;d rather go straight to <code>MyFoo</code>.</p>

<p>I was using Castor to do the former some time ago. It sounded like a good idea, and I got going really quickly. However, I quickly didn&#8217;t like the objects its produced so had to modify the <code>mapping.xml</code> to &#8220;tailor&#8221; the marshalling. Still fine, this was ok for a while but soon enough I descended into a kind of Castor mapping hell. I seriously spent days trying to tweak things and had to compromise the model in the end.</p>

<p>After some reflection, I thought I&#8217;d try and dump Castor. I replaced the marshalling with merging to a Freemarker template and produced cleaner XML in under an hour. The unmarshalling, replaced with manually parsing the XML and inserting elements directly into objects. I couldn&#8217;t believe how much less pain I was feeling.</p>

<p>For me, the overhead of maintaining these more &#8220;manual&#8221; approaches is far less than working around any framework mismatches. If you&#8217;re lucky enough to find a marhsalling framework that can grow with you, fair play, but I&#8217;m heavily biased towards a more manual approach these days. Down with [insert framework here].</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/05/01/setter-vs-constructor-injection/">Setter vs Constructor Injection</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-05-01T00:00:00+01:00" pubdate data-updated="true">May 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So what is the argument for / against? It can be a tough one to describe as I recently discovered.</p>

<p>You can say that constructor injection forces an object to have its <strong>dependencies set explicitly</strong> and setter injection is <strong>open to forgetfulness or misuse</strong> but how powerful an argument is that really? Surely the tests would catch it if you miss a set call? Constructor injection does say upfront &#8220;this is what I need&#8221;, so there&#8217;s no &#8220;first call this, then this and don&#8217;t forget this&#8221; - its explicit and you don&#8217;t need to know about the internals that setters expose. That&#8217;s useful. But on the small, how complex do the combination of set calls get?</p>

<p>If you use your IDE effectively, <strong>constructor injection will have better rafactoring support</strong>. There&#8217;s no way an IDE will interpret adding a field to mean calling setter for it. However, if add a constructor parameter, the IDE can push a default value out to all usages.</p>

<p>I don&#8217;t think that a <strong>large number of constructor arguments</strong> justifies defecting to the setter camp as the real smell here is often that the class is doing too much and/or has too many dependencies. It&#8217;s often cited that the reason there are lots of setters is because of particular <strong>dependency injection framework leads you</strong> in that direction but why compromise (I should probably say, <em>comply</em>) because you&#8217;re <em>told</em> to? What if that compromises other design goals?</p>

<p>How about the way the system would <strong>grow using constructors vs setters</strong>? I think this is where the real argument lies. You can move forward perfectly happily with either approach, content with the fact that dependencies are isolated. Testing becomes simpler, more focused on the objects under test and the earth continues to orbit the sun. Its only much later when the system is all but grown up that you can look back and reflect. Have setters contributed to creating a system that is assembled in a complex, disheveled way? Are you leaning on external (ahem, xml) configuration to manage this? Alternatively, has a constructor centric approach left you with a system with a more concise assembly strategy? Which has more noise? You tell me&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/04/25/wrapping-exceptions-is-dull/">Wrapping Exceptions is Dull</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-04-25T00:00:00+01:00" pubdate data-updated="true">Apr 25<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m totally bored of wrapping exceptions in Java,</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>   <span class="c1">// do something</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BoredomException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="c1">// do something else</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s verbose, ugly and has nothing to do with what you&#8217;re really trying to convey. It&#8217;s just noise. For example, when using the <em>dreadful</em> Google Data API to access my calendar, I wrapped a couple of underlying Google services to be able to mock. Each service wanted to throw a bunch of Google specific exceptions which I wanted to rethrow as application specific exceptions.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">O</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CalendarException</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">call</span><span class="o">();</span>  <span class="c1">// the call to the google service</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CalendarException</span><span class="o">(</span><span class="n">BAD_URL_MESSAGE</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CalendarException</span><span class="o">(</span><span class="n">IO_EXCEPTION_MESSAGE</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">AuthenticationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CalendarException</span><span class="o">(</span><span class="n">AUTHENTICATION_MESSAGE</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ServiceException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CalendarException</span><span class="o">(</span><span class="n">SERVICE_EXCEPTION_MESSAGE</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If I didn&#8217;t delegate like this, every internal call would have to wrap and handle the google exceptions rather than my application specific one. There&#8217;s no class hierarchy in Google&#8217;s API here.</p>

<p>As I&#8217;ve done this a few times, I decided to add it to <a href="http://tempusfugitlibrary.org/">tempus-fugit</a> as a <code>ExceptionWrapper</code> class. Using this class, you can wrap a <code>Callable</code> to rethrow any caught exception as some other (including the underlying exception as the <code>cause</code>).</p>

<p>So, in a similar way to the above, the client can ignore any declared
exceptions and just rethrow them in-line. For example,</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">wrapAnyException</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServiceException</span> <span class="o">{</span>
</span><span class='line'>         <span class="c1">// nasty code throwing a bunch of exceptions</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">},</span> <span class="n">with</span><span class="o">(</span><span class="n">CalendarException</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>when this is in-lined further, it hopefully becomes more succinct.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">wrapAnyException</span><span class="o">(</span><span class="n">serviceCall</span><span class="o">(),</span> <span class="n">with</span><span class="o">(</span><span class="n">CalendarException</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will wrap any exception and rethrow as a new <code>CalendarException</code> to include as the cause any underlying exception. It uses reflection to create the new exception, and forces the syntactically sugary <code>with</code> by taking a <code>WithException</code> as the second parameter.</p>

<p>It&#8217;s in <a href="http://tempusfugitlibrary.org/">tempus-fugit</a>, let me know if you find it useful.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/03/19/nibbles-cat/">Nibbles the Cat & Concurrency</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-19T00:00:00+00:00" pubdate data-updated="true">Mar 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently introduced a deadlock into our performance monitoring. I inadvertently prevented a statistic collection daemon I wrote from shutting down thanks to some unlucky timing and a bad synchronisation policy. Because the synchronisation that was involved was distributed across a couple of classes (including some external classes) it wasn&#8217;t obvious where they clashed. It got me thinking more about deadlocks and how many times we <em>actually </em>see them in real systems. In the end, I created a <code>DeadlockDetector</code> class.</p>

<p>I&#8217;m talking here about Java level deadlocks and to illustrate the point, poor old <code>Nibbles</code> got himself into quite a pickle. The situation is like this; <code>Nibbles</code> has been abducted and the <code>Kidnapper</code> and <code>Negotiator</code> threads have started a dialogue.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">potentialDeadlock</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">new</span> <span class="nf">Kidnapper</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>     <span class="k">new</span> <span class="nf">Negotiator</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, in the process of negotiation it becomes apparent that the  <code>Kidnapper</code> is unwilling to release poor <code>Nibbles</code> until he has received the <code>Cash</code> and the <code>Negotiator</code> is unwilling to part with the <code>Cash</code> until he has poor <code>Nibbles</code> back in his arms.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/03/19/nibbles-cat/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/01/04/type-safe-annotation/">Type Safe Annotation</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-01-04T00:00:00+00:00" pubdate data-updated="true">Jan 4<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>
    <script type="text/javascript">
    function trackOutboundLink(link, category, action) {

        try {
            _gaq.push(['_trackEvent', category , action]);
        } catch(err){}

        setTimeout(function() {
            document.location.href = link.href;
        }, 100);
    }
    </script>
</div>


<p>A new year and another Java gripe! This time its annotations and the lack of anything useful by way of parameters. Implementing the Goetz annotations from <a href="http://amzn.to/TtEnWO" onClick="trackOutboundLink(this, 'Outbound Links', 'amazon.com'); return false;">Concurrency In Practice</a>, I wanted to include an enum as a parameter type. Kind of like this</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">GuardedBy</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Type</span> <span class="nf">value</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>   <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Type</span> <span class="o">{</span> <span class="n">FIELD</span><span class="o">,</span> <span class="n">CLASS</span><span class="o">;</span> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/01/04/type-safe-annotation/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2009/12/29/running-junit-tests-in-parallel/">Running JUnit tests in parallel</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2009-12-29T00:00:00+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been playing with running tests in their own threads for a while now (in particular with reference to <a href="/blog/2008/12/30/be-explicit-about-ui-thread-in-swt/">GUI testing</a>) and am starting to feel comfortable with my approach. Today I was working on running tests in parallel with JUnit.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2009/12/29/running-junit-tests-in-parallel/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2009/12/24/flickering-tests/">Flickering Tests and a JUnit Rule</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2009-12-24T00:00:00+00:00" pubdate data-updated="true">Dec 24<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Occasionally I&#8217;ll see flickering tests. Sometimes they&#8217;re green, sometimes they&#8217;re red and this can happen without any code changes. What bugs me the most is that when trying to fix the problem, I can never be sure that I haven&#8217;t just been lucky and the green I&#8217;m seeing isn&#8217;t really a false positive. I&#8217;ll have to manually run the test several times before my confidence grows.</p>

<p>In an attempt to ease the situation, I created an <code>@Intermittent</code> annotation with a corresponding JUnit <code>Rule</code> and <code>Runner</code>. Now, I can mark up a suspect test and get JUnit to do the repetition. Joy.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="nd">@Intermittent</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">flickering</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="c1">// ...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can then use the <code>IntermittentRule</code> to run the test method repeatedly.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FlickeringTest</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Rule</span> <span class="kd">public</span> <span class="n">IntermittentRule</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntermittentRule</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Test</span>
</span><span class='line'>    <span class="nd">@Intermittent</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flickering</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or use the <code>@RunWith</code> annotation to run the test using the <code>IntermittentTestRunner</code>.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@RunWith</span><span class="o">(</span><span class="n">IntermittentTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FlickeringTest</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Rule</span> <span class="kd">public</span> <span class="n">IntermittentRule</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntermittentRule</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Test</span>
</span><span class='line'>    <span class="nd">@Intermittent</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flickering</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What&#8217;s interesting here is the way in which the <code>Rule</code> and <code>Runner</code> interact with
JUnit. Newer versions of JUnit have introduced the idea of <code>Rule</code>s and
<code>Statement</code>s. Using a <code>Rule</code> allows access to the underlying <code>Statement</code> which in
our case is the action to run the test method. So we&#8217;re able to run the
underlying statement again and again. Nice.</p>

<p>The <code>Runner</code> however can hook into JUnit&#8217;s framework in a different way. It can
access more than one statement and so can position itself slightly differently.
What this means for us is that when using the <code>Rule</code> above, any <code>@Before</code> or <code>@After</code>
methods will only be run once but the test method will run multiple times.
Using the <code>Runner</code> above however, will run any <code>@Before</code> or <code>@After</code> methods
once for each test repetition.</p>

<p>The code is available as part of the <a href="http://tempusfugitlibrary.org/">tempus-fugit</a> library, feel free to look around.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2009/12/24/deadlock/">Deadlock detection in Java</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2009-12-24T00:00:00+00:00" pubdate data-updated="true">Dec 24<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently added a basic deadlock detection mechanism to <a href="http://tempusfugitlibrary.org/">tempus-fugit</a>. The <a href="http://tempusfugitlibrary.org/recipes/2012/05/26/detecting-deadlocks/">DeadlockDetector</a> class allows you to programmatically detect basic deadlocks in your Java code. You can output deadlocks using the following code (note that printing a thread dump using the <code>ThreadDump</code> class will automatically attempt to find any deadlocks).</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">DeadlockDetector</span><span class="o">.</span><span class="na">printDeadlocks</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2009/12/24/deadlock/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2009/12/10/atomiticy-of-thread-class/">Atomiticy of the Thread class</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2009-12-10T00:00:00+00:00" pubdate data-updated="true">Dec 10<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had an interesting time getting a couple of tests running for <a href="http://tempusfugitlibrary.org/">tempus-fugit</a> recently. It threw up a couple of interesting aspects about using threads that I hadn&#8217;t come across before.</p>

<p>In one particular test, I wanted to show that interrupt is called on a thread and so followed what&#8217;s becoming a common pattern for me.</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">sleepInterrupted</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">threadSleepsForever</span><span class="o">();</span>
</span><span class='line'>   <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>   <span class="n">waitForStartup</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span><span class='line'>   <span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
</span><span class='line'>   <span class="n">waitForShutdown</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span><span class='line'>   <span class="n">assertThat</span><span class="o">(</span><span class="n">thread</span><span class="o">.</span><span class="na">isInterrupted</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The alternative patten is to wait for the assertion and avoid the wait for shutdown method above. Either way, the test above is testing that the thread created has been interrupted by checking the interrupt flag.</p>

<p>The test was failing for me even though I was able to show that the interrupt is called and the interrupt flag is set immediately after the sleeping thread is woken. However, when the test reached the assertion, it was false. Weird.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2009/12/10/atomiticy-of-thread-class/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/24/writing-my-book/">Writing my Book</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/24/mac-tips/">Mac Tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/23/useful-git-commands/">Useful Git Commands</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/10/stack-vs-deque/">Java Stack vs Deque</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/06/sending-messages-vs-method-invocation/">Sending Messages vs Method Invocation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/15/daily-standups-dont-work/">Daily Standups Don&#8217;t Work</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/14/diff-excel-with-java-and-hamcrest/">Diff Excel with Java and Hamcrest</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/28/play-it-next/">Play it Next App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/13/oauth-and-http-part-iii/">FreeAgent, OAuth &amp; HTTP (Part III)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/12/oauth-and-http-part-ii/">FreeAgent, OAuth &amp; HTTP (Part II)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/11/oauth-and-http-part-i/">FreeAgent, OAuth &amp; HTTP (Part I)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/28/mountain-lion-carnage/">Mountain Lion Carnage</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <p align="justify">     
      <a href="/blog/categories/agile/">agile</a>
      <a href="/blog/categories/coaching/">coaching</a>
      <a href="/blog/categories/concurrency/">concurrency</a>
      <a href="/blog/categories/exceptions/">exception-handling</a>
      <a href="/blog/categories/java/">java</a>
      <a href="/blog/categories/mocking/">mocking</a>
      <a href="/blog/categories/object-oriented/">object-oriented</a>
      <a href="/blog/categories/performance/">performance</a>
      <a href="/blog/categories/recipes/">recipes</a>
      <a href="/blog/categories/rest/">REST</a>
      <a href="/blog/categories/scala/">scala</a>
      <a href="/blog/categories/tempus-fugit/">tempus-fugit</a>
      <a href="/blog/categories/testing/">testing</a>
  </p>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/14/diff-excel-with-java-and-hamcrest/">Diff Excel with Java and Hamcrest</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/10/18/logging-is-evil-but/">Logging is evil but&#8230;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/03/04/jdk-7-previewed/">JDK7 Previewed</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/10/artcile-in-javatech-journal/">JDK7 Article in JavaTech Journal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/22/loggin-is-still-evil-but/">Logging is still evil but&#8230;</a>
      </li>
    
  </ul>
</section>
<section>
    <h1>Available on Leanpub</h1>
    <br/>
    <iframe width="250" height="400" src="https://leanpub.com/essential_acceptance_testing/embed" frameborder="0" allowtransparency="true"></iframe>
</section>
<section>
    <h1>Publications</h1>
    <br/>
    <a href="/resources/JTJ-2011-05.pdf"><img class="left" src="/images/JTJ-2011-05.png" alt="Read my JDK7 article" width="125" height="150" onclick="_gaq.push(['_trackEvent', 'download', 'jdk7-article', 'pdf']);"></a>
    <p>
        My article on JDK7 in <a href="http://jaxenter.com/java-tech-journal">JavaTech Journal</a> (May 2011)
    </p>
    <br/>
    <br/>
    <br/>
    <br/>

    <br/>
    <a href="/resources/concurrency-control-1.0-draft.pdf"><img class="left" src="/images/concurrency-control-1.0-draft.png" alt="Read my JDK7 article" width="125" height="150" onclick="_gaq.push(['_trackEvent', 'download', 'concurrency-control', 'pdf']);"></a>
    <p>
        My draft paper discussing <a href="/resources/concurrency-control-1.0-draft.pdf">Optimistic and Pessimistic Concurrency Control with Shared Memory Models</a>.
    </p>

    <br/>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jamanifin", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/jamanifin" class="twitter-follow-button" data-show-count="false">Follow @jamanifin</a>
  
</section>

<section>
    <h1>Links</h1>
    <ul>
        <li><a href="http://dan.bodar.com/">Dan Bodart</a></li>
        <li><a href="http://www.natpryce.com/">Nat Pryce</a></li>
        <li><a href="http://www.higherorderlogic.com/">Steve Freeman</a></li>
        <li><a href="http://langrsoft.com/">Jeff Langr</a></li>
        <li><a href="http://tech.puredanger.com/">Alex Miller</a></li>
        <li><a href="http://blog.davidpeterson.co.uk/">David Peterson</a></li>
    </ul>
</section>
<section xmlns="http://www.w3.org/1999/html">
    </br>
    </br>
    </br>
    <img src="images/top5.png" style="border: none; -webkit-box-shadow: none; box-shadow: none; transform: rotate(-5deg); -moz-transform: rotate(-5deg); -webkit-transform: rotate(-5deg);"/>
    </br>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2006-2013 - Toby Weston -
   <a href="/excludeme">exclude from analytics</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, theme by <a href="http://melandri.net/"> @alemelandri</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'badrobot';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
