<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2012-03-29-building-better-exceptions/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Building Better Exceptions</title><meta name="title" content="Building Better Exceptions"><meta name="description" content="Design better exceptions by treating them as proper objects with behaviour. Apply the Law of Demeter and 'tell don't ask' to keep exception handling clean."><meta name="keywords" content="Java exceptions, exception design, checked vs unchecked, Law of Demeter, tell don't ask, exception behaviour"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2012-03-29-building-better-exceptions/"><meta property="og:title" content="Building Better Exceptions"><meta property="og:description" content="Design better exceptions by treating them as proper objects with behaviour. Apply the Law of Demeter and 'tell don't ask' to keep exception handling clean."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2012-03-29-building-better-exceptions/"><meta property="twitter:title" content="Building Better Exceptions"><meta property="twitter:description" content="Design better exceptions by treating them as proper objects with behaviour. Apply the Law of Demeter and 'tell don't ask' to keep exception handling clean."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building Better Exceptions","description":"Design better exceptions by treating them as proper objects with behaviour. Apply the Law of Demeter and 'tell don't ask' to keep exception handling clean.","datePublished":"2012-03-28T00:00:00.000Z","url":"https://baddotrobot.com/blog/2012-03-29-building-better-exceptions/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.BIJT_GkW.css">
<link rel="stylesheet" href="/_astro/_slug_.CTb-p3zm.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Building Better Exceptions</h1>  <p class="article-description">Design better exceptions by treating them as proper objects with behaviour. Apply the Law of Demeter and &#39;tell don&#39;t ask&#39; to keep exception handling clean.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2012-03-28T00:00:00.000Z"> Mar 28, 2012 </time> </div>  </div> <div class="prose">  <p>In the <a href="/blog/2012-03-28-exception-handling-as-a-system-wide-concern">previous post</a>, we looked at being more explicit about a system’s exception handling policies. By identifying the boundaries within your system, you isolate the points at which you handle exceptions.</p>
<p>This post takes the idea further by talking about exceptions as <em>real</em> objects and suggests only ever creating subclasses of <code>RuntimeException</code> for your application exceptions. Once exception handling points are isolated, testing becomes more straightforward and we reduce the noise of checked exceptions. When we get it right, we should never need to assert against exception messages.</p>
<h2 id="exceptions-are-objects">Exceptions are Objects</h2>
<p>We tend to think of exceptions as beans; objects with a <code>message</code> that we get and display. It’s easy to forget that exceptions are objects too. How often do you see this type of thing in the same code base.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> BadRequestException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"the field 'customer' is missing from the request"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> BadRequestException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"'customer' is missing"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> BadRequestException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"can not parse request"</span><span style="color:#E1E4E8"> );</span></span></code></pre>
<p>It’s an example of bad encapsulation in the <code>BadRequestException</code> class. It’s hard to tell if the examples above should be handled the same or differently. There’s certainly an inconsistency between the wording of the first two. Are they the same error? It’s also not clear where the message is going to end up? A better idea would be to create sub-classes for each.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MissingFieldException</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> BadRequestException</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> MissingFieldException</span><span style="color:#E1E4E8">(Field </span><span style="color:#FFAB70">field</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.field </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> field;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>All other constructors have been disabled so the exception can only be constructed as we intend. It can still be handled in a <code>catch</code> block built for <code>BadRequest</code> (and it’s there that we would decide how to map the exception type to a presentable form). We’ve intentionally <em>avoided</em> something like</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#B392F0"> MissingFieldException</span><span style="color:#E1E4E8">(Field field) {</span></span>
<span class="line"><span style="color:#79B8FF">    super</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"the field "</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> "' is missing from the request"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>because the message is completely unimportant to the exception. It’s the handling that’s important and it’s in the catch block that we can map to a message (if appropriate). We’re encapsulating the internal details. For example, at the UI, we may map the exception to a message for display but at an internal boundary, we may generate an event for support staff that maps to a different message.</p>
<p>Applying object-oriented principles like encapsulation to exceptions means that they can do more than just be <em>caught</em>. As first class objects, they can carry <em>behaviour</em> and so can be tested appropriately. How many <em>unit</em> tests have you written for an <code>Exception</code> class?</p>
<h2 id="tell-dont-ask">Tell. Don’t ask</h2>
<p>We can take this further and try to apply the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">law of demeter</a> to our objects. Rather than <em>get</em> something and perform conditional logic based on it, we should be able to <em>tell</em> the object to do something. It can make decisions based on its internal, encapsulated data which means decision points are localised to appropriate places.</p>
<p>How do we apply this to exceptions? Well, now we’ve got nicely encapsulated data it’s clear that the exception itself is responsible for <em>using</em> it. In the example above, we’ve encapsulated a <code>field</code> object. The implication being that the exception may want to influence something based on it. This could be the simple case where the exception can <em>present itself to some object</em>, in this example an implementation of a <code>Description</code> interface.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> applyTo</span><span style="color:#E1E4E8">(Description description) {</span></span>
<span class="line"><span style="color:#E1E4E8">    description.</span><span style="color:#B392F0">append</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"the field"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">appendValue</span><span style="color:#E1E4E8">(field).</span><span style="color:#B392F0">append</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"is missing from the request"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="the-impact-on-testing">The Impact on Testing</h2>
<p>If we handle exceptions <em>only</em> at the boundaries, we do so based on <em>type</em> in the <code>catch</code> block. Even at this point, we shouldn’t ask for the internals of the exception and so we shouldn’t have to <em>test against them</em>. The handler can <em>tell</em> the exception rather than <em>ask</em> and testing becomes much more straight forward.</p>
<blockquote>
<p>If a class throws an exception, <em>{” we should never need to test the content of the message in a unit test ”}</em> for that class. It’s the class that would use the message that should be tested. However, if we’ve done things correctly, then no behaviour should depend on the message so what can we test?</p>
</blockquote>
<p>The first part is to test that the handling class responds appropriately to the exception <em>type</em> and that those exceptions are generated only at appropriate times. The second part is that if the handling class does depend on some internal details, we should encapsulate this, apply <em>tell don’t ask</em> and so can write simpler tests.</p>
<p>In this way, we’re just applying the <a href="/blog/2012-02-13-hexagonal-acceptance-testing/">ports and adaptors</a> idea to write overlapping tests which combine for coverage but are still simple on their own.</p>
<h2 id="only-using-runtime-exceptions">Only using Runtime Exceptions</h2>
<p>If you isolate exception handling to a specific boundary, you emphasise the point at which exceptions are caught. If you’re catching and dealing with exceptions in a single, well known place, why would you need to use checked exceptions?</p>
<p>Checked exceptions cause noise. That’s all. Nothing else bad about them but they imply a defensive style of programming that has no place in the brave world of XP. The alternative, to throw only runtime exceptions, seems fraught with danger. What if you forget to catch it? If you’ve setup a exception handling as a system wide policy, you would have already established where to catch them and you’ll have programmatically prevented that scenario.</p>
<p>If that’s truly the case, you can create application specific exceptions that sub-class <code>RuntimeException</code> and clean up the code base considerably. However, it’s a potentially bad idea to actually throw <code>RuntimeException</code> as this subverts the explicit catching strategy. I generally consider <code>RuntimeException</code> as an abstract class. It doesn’t make sense on its own because it implies any <code>catch</code> clause is too generic. Instead, create an root application exception that extends <code>RuntimeException</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> BadRobotApplicationException</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> RuntimeException</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">   // ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>In the next post <a href="/blog/2012-03-30-scala-exception-handling">Scala Exception Handling</a>, well take a look at how Scala embraces some of these ideas. For example, in Scala <em>all</em> exceptions are based on <code>RuntimeException</code>.</p>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>