<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.18.0"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1PVLDLDJQN"></script><script>(function(){const gaId = "G-1PVLDLDJQN";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    })();</script><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2014-10-22-scala-mixins/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Scala Mixins: The Right Way</title><meta name="title" content="Scala Mixins: The Right Way"><meta name="description" content="Scala traits can be used for both polymorphism and mixins, but mixing these uses leads to trouble. Learn when using a trait as a mixin is genuinely appropriate."><meta name="keywords" content="Scala traits, mixin, inheritance, composition, code reuse, Scala, ad-hoc polymorphism"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2014-10-22-scala-mixins/"><meta property="og:title" content="Scala Mixins: The Right Way"><meta property="og:description" content="Scala traits can be used for both polymorphism and mixins, but mixing these uses leads to trouble. Learn when using a trait as a mixin is genuinely appropriate."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2014-10-22-scala-mixins/"><meta property="twitter:title" content="Scala Mixins: The Right Way"><meta property="twitter:description" content="Scala traits can be used for both polymorphism and mixins, but mixing these uses leads to trouble. Learn when using a trait as a mixin is genuinely appropriate."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Scala Mixins: The Right Way","description":"Scala traits can be used for both polymorphism and mixins, but mixing these uses leads to trouble. Learn when using a trait as a mixin is genuinely appropriate.","datePublished":"2014-09-22T00:00:00.000Z","image":"https://baddotrobot.com/images/heroes/functional-programming.jpg","url":"https://baddotrobot.com/blog/2014-10-22-scala-mixins/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.BiihJROh.css">
<style>.giscus-wrapper[data-astro-cid-2s6z27su]{margin-top:3rem;padding-top:0}.giscus-divider[data-astro-cid-2s6z27su]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}.giscus-divider[data-astro-cid-2s6z27su]:before,.giscus-divider[data-astro-cid-2s6z27su]:after{content:"";flex:1;height:1px;background:var(--border)}.giscus-divider-label[data-astro-cid-2s6z27su]{text-transform:uppercase;letter-spacing:.2em;color:var(--accent);font-size:.75rem;font-weight:600;white-space:nowrap}.giscus[data-astro-cid-2s6z27su],.giscus-frame[data-astro-cid-2s6z27su]{width:100%}
</style>
<link rel="stylesheet" href="/_astro/_slug_.Bryw6KM9.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> <div id="header-animation-switcher" class="header-switcher" style="display: none;" data-astro-cid-3ef6ksr2> <div class="switcher-buttons" data-astro-cid-3ef6ksr2> <button class="switcher-btn active" data-option="1" title="Smooth Fade Only" data-astro-cid-3ef6ksr2> <span class="btn-icon" data-astro-cid-3ef6ksr2>‚ö´</span> </button> <button class="switcher-btn" data-option="2" title="Fade + Gentle Lift" data-astro-cid-3ef6ksr2> <span class="btn-icon" data-astro-cid-3ef6ksr2>‚¨ÜÔ∏è</span> </button> <button class="switcher-btn" data-option="3" title="Slide In Left" data-astro-cid-3ef6ksr2> <span class="btn-icon" data-astro-cid-3ef6ksr2>‚û°Ô∏è</span> </button> <button class="switcher-btn" data-option="4" title="Blur Fade" data-astro-cid-3ef6ksr2> <span class="btn-icon" data-astro-cid-3ef6ksr2>üîÆ</span> </button> <button class="switcher-btn" data-option="5" title="Subtle Scale" data-astro-cid-3ef6ksr2> <span class="btn-icon" data-astro-cid-3ef6ksr2>üìà</span> </button> </div> </div> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <!--{heroImage && (--> <!--  <div class="hero-image mb-8">--> <!--    <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-lg" />--> <!--  </div>--> <!--)}--> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Scala Mixins: The Right Way</h1>  <p class="article-description">Scala traits can be used for both polymorphism and mixins, but mixing these uses leads to trouble. Learn when using a trait as a mixin is genuinely appropriate.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2014-09-22T00:00:00.000Z"> Sep 22, 2014 </time> </div>  </div> <div class="prose">  <p>Scala traits are interesting because they can be used for [inclusion polymorphism](<a href="http://en.wikipedia.org/wiki/Polymorphism_(computer_science)">http://en.wikipedia.org/wiki/Polymorphism_(computer_science)</a> <em>and</em> to <a href="http://en.wikipedia.org/wiki/Mixin">mixin</a> behaviour. I‚Äôve found tension here though, as the former uses inheritance and the later is more about code re-use. So when a Scala class extends a trait with behaviour, it seems to go against the generally accepted view that using inheritance as a mechanism for code re-use <a href="/blog/2009-01-24-inheritance-vs-composition/">is a bad idea</a>.</p>
<p>It can be tricky not break the <a href="http://en.wikipedia.org/wiki/Composition_over_inheritance#Benefits">inheritance vs. composition</a> principle when using traits with behaviour. Is it clear to you when you might be?</p>
<h2 id="mixins-the-wrong-way">Mixins the Wrong Way</h2>
<p><a href="https://www.amazon.co.uk/Programming-Scala-Martin-Odersky/dp/0981531644/ref=as_sl_pc_ss_til?tag=baddotrobotco-21&#x26;linkCode=w01&#x26;linkId=DNXSQPP4AVLACD7U&#x26;creativeASIN=0981531644">Odersky</a> calls traits with behaviour ‚Äúmixin traits‚Äù. To be a genuine mixin trait, it should be used to mixin behaviour and not just something you inherit from. But what‚Äôs the difference? Let‚Äôs look at an example.</p>
<p>Let‚Äôs say that you have a <a href="http://martinfowler.com/eaaCatalog/repository.html">repository</a> style class who‚Äôs API talks about business operations, a <code>Customers</code> class for example. You might have an database backed version and you don‚Äôt want anything going behind your back and messing with the data; everything in production code should go through your business API.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> OracleCustomers</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">customer</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Customer</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> getCustomer</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">CustomerId</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> getBasketValue</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">query</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">CustomerQuery</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> ship</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">query</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">CustomerQuery</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Now let‚Äôs say that you want a test fixture to allow you to quickly setup test data in your <code>Customers</code> without having to go through the production API. You can provide an implementation to a trait and collect some data together like this;</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">trait</span><span style="color:#B392F0"> BackdoorCustomers</span><span style="color:#E1E4E8"> {                               </span><span style="color:#6A737D">// &#x3C;- bad name, this is really a "fixture"</span></span>
<span class="line"><span style="color:#F97583">    abstract</span><span style="color:#F97583"> val</span><span style="color:#FFAB70"> customers</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Customers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> addSomeCustomersWithFullBaskets</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        customers.add(</span><span style="color:#B392F0">RandomCustomer</span><span style="color:#E1E4E8">().</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RandomFullBasket</span><span style="color:#E1E4E8">()))</span></span>
<span class="line"><span style="color:#E1E4E8">        customers.add(</span><span style="color:#B392F0">RandomDiscountedCustomer</span><span style="color:#E1E4E8">().</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RandomFullBasket</span><span style="color:#E1E4E8">()))            </span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> addSomeCustomersWithEmptyBaskets</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        customers.add(</span><span style="color:#B392F0">RandomCustomer</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">        customers.add(</span><span style="color:#B392F0">RandomExpiredCustomer</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This says that extending classes must provide a value for <code>customers</code>. It implements some coarse grained test setup against <code>customers</code>. So when writing a test, it‚Äôs easy to just extend the trait and slot in an implementation of <code>customers</code>. For example an <code>InMemoryCustomers</code> or an Oracle implementation that by-passes any constraint checking the proper API might enforce.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> OracleCustomerTest</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> BackdoorCustomers</span><span style="color:#E1E4E8"> {        </span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    override</span><span style="color:#F97583"> val</span><span style="color:#FFAB70"> customers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> InMemoryCustomers</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    application </span><span style="color:#F97583">=</span><span style="color:#B392F0"> ApplicationBuilder</span><span style="color:#E1E4E8">.</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(customers)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    test(</span><span style="color:#9ECBFF">"ensure basket totals are correct when discounts are applied"</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.addSomeCustomersWithFullBaskets()</span></span>
<span class="line"><span style="color:#F97583">        val</span><span style="color:#FFAB70"> result</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> application.doSomethingAgainstCustomersViaTheApi</span></span>
<span class="line"><span style="color:#E1E4E8">        result should be(asExpected)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>But we‚Äôre saying here that an <code>OracleCustomerTest</code> <em>is a</em> <code>BackdoorCustomers</code>. That doesn‚Äôt even make sense. There‚Äôs no strong notion of a <code>BackdoorCustomers</code>; it‚Äôs not a meaningful <em>noun</em>. Best case scenario, you‚Äôre upfront about the fact that it‚Äôs a fixture and rename <code>BackdoorCustomers</code> to <code>CustomersTestFixture</code> but even then, the <em>test</em> is not a <em>fixture</em>, the two are independent. <strong>One is test apparatus that supports the test, the other is the test or experiment itself</strong>.</p>
<p>It‚Äôs tempting to use traits like this under the pretense of ‚Äúmixing in‚Äù behaviour but you‚Äôre really inheriting behaviour from something (that in our case) isn‚Äôt related. You‚Äôre precluding any type of substitution or inclusion polymorphism. Now arguably, substitution isn‚Äôt of great value in test code like this but it‚Äôs still a laudable goal.</p>
<h2 id="proper-mixins">Proper Mixins</h2>
<p>Using inheritance to mixin behaviour contradicts the inheritance vs. composition principle. So just when is a trait with behaviour a genuine mixin? The trick is in <em>how</em> we mix it in. Before, we made the <em>types</em> inherit the trait but we could have mixed the trait into a specific <em>instance</em>.</p>
<p>For example, we can rework our trait to be a self type.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">trait</span><span style="color:#B392F0"> BackdoorCustomers</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Customers</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> addSomeCustomersWithFullBaskets</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        add(</span><span style="color:#B392F0">RandomCustomer</span><span style="color:#E1E4E8">().</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RandomFullBasket</span><span style="color:#E1E4E8">()))</span></span>
<span class="line"><span style="color:#E1E4E8">        add(</span><span style="color:#B392F0">RandomDiscountedCustomer</span><span style="color:#E1E4E8">().</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RandomFullBasket</span><span style="color:#E1E4E8">()))            </span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> addSomeCustomersWithEmptyBaskets</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        add(</span><span style="color:#B392F0">RandomCustomer</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">        add(</span><span style="color:#B392F0">RandomExpiredCustomer</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>It now enforces implementers to also be a sub-type of <code>Customers</code>. This, in turn, forces us to rewrite the test</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> OracleCustomerTest</span><span style="color:#E1E4E8"> {        </span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> val</span><span style="color:#FFAB70"> customers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> InMemoryCustomers</span><span style="color:#F97583"> with</span><span style="color:#B392F0"> BackdoorCustomers</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> val</span><span style="color:#FFAB70"> application</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ApplicationBuilder</span><span style="color:#E1E4E8">.</span><span style="color:#F97583">with</span><span style="color:#E1E4E8">(customers)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    test(</span><span style="color:#9ECBFF">"ensure basket totals are correct when discounts are applied"</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>So now our test is not inheriting an orthogonal type. From an object-oriented perspective, it‚Äôs much cleaner. We use composition to give the test a <code>customers</code> instance but this time, we treat it as two things. The actual type of the thing is;</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#B392F0">InMemoryCustomers</span><span style="color:#F97583"> with</span><span style="color:#B392F0"> BackdoorCustomers</span></span></code></pre>
<p>So all the backdoor methods work along with the API methods but now we can clearer about which is which. For example,</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#E1E4E8">customers.addSomeCustomersWithFullBaskets()         </span><span style="color:#6A737D">// &#x3C;- a backdoor "fixture" method</span></span>
<span class="line"><span style="color:#E1E4E8">application.doSomethingAgainstCustomersViaTheApi    </span><span style="color:#6A737D">// &#x3C;- more likely to be the method under test</span></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Scala is both an object-oriented language and a functional language. So unless your team is entirely behind doing things functionally, you‚Äôre still going to come across object-oriented thinking and principles. Traits that have behaviour make it awkward because functionally-thinking, you could argue that nouns aren‚Äôt important and behaviour in traits is just behaviour. So why not extend that behaviour by whatever means (including inheritance)?</p>
<p>Because Scala <em>has objects</em> you can‚Äôt really just ignore object-oriented semantics and thinking. Not unless, like I say, the entire team buy into functional only code. If that were the case, then reusable behaviour should really be represented as functions on <a href="http://tutorials.jenkov.com/scala/singleton-and-companion-objects.html">Scala singleton objects</a> and not traits. You‚Äôd be forced to use composition anyway.</p>
<p>By that logic, it feels like extending traits for re-use in a functional programming context is just lazy. Mixing behaviour ‚Äúthe right way‚Äù seems much less contentious.</p>
<h2 id="recommended-reading">Recommended Reading</h2>
<ul>
<li><a href="http://leanpub.com/whatsnewjava8">What‚Äôs New in Java 8</a> (LeanPub), Toby Weston</li>
<li><a href="https://amzn.eu/d/f0iH92N">Learning Java Lambdas</a> (Amazon), Toby Weston</li>
<li><a href="https://amzn.eu/d/dcJRJ41">Learn Scala for Java Developers</a> (Amazon), Toby Weston</li>
</ul>
<p>¬†
¬†
¬†</p>  </div> <div class="giscus-wrapper" data-astro-cid-2s6z27su><div class="giscus-divider" data-astro-cid-2s6z27su><span class="giscus-divider-label" data-astro-cid-2s6z27su>Discussion</span></div><div class="giscus" id="giscus-container" data-astro-cid-2s6z27su></div></div><script type="module">const repo = "tobyweston/blog";
const repoId = "MDEwOlJlcG9zaXRvcnkzMzUyNTYw";
const category = "General";
const categoryId = "DIC_kwDOADMn8M4C3bWR";

    function loadGiscus() {
      const container = document.getElementById('giscus-container');
      if (!container) return;

      const script = document.createElement('script');
      script.src            = 'https://giscus.app/client.js';
      script.setAttribute('data-repo',              repo);
      script.setAttribute('data-repo-id',           repoId);
      script.setAttribute('data-category',          category);
      script.setAttribute('data-category-id',       categoryId);
      script.setAttribute('data-mapping',           'pathname');
      script.setAttribute('data-strict',            '0');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata',     '0');
      script.setAttribute('data-input-position',    'top');
      script.setAttribute('data-theme',             'light');
      script.setAttribute('data-lang',              'en');
      script.setAttribute('data-loading',           'lazy');
      script.crossOrigin    = 'anonymous';
      script.async          = true;
      container.appendChild(script);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadGiscus);
    } else {
      loadGiscus();
    }
  </script> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>