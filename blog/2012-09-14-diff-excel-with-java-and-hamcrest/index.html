<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1PVLDLDJQN"></script><script>(function(){const gaId = "G-1PVLDLDJQN";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    })();</script><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2012-09-14-diff-excel-with-java-and-hamcrest/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>Diff Excel with Java and Hamcrest</title><meta name="title" content="Diff Excel with Java and Hamcrest"><meta name="description" content="Compare Excel spreadsheets in Java tests using Hamcrest matchers and Apache POI. The simple-excel library makes asserting on spreadsheet content straightforward."><meta name="keywords" content="Excel diff, Java, Hamcrest, Apache POI, spreadsheet testing, compare Excel files, simple-excel"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2012-09-14-diff-excel-with-java-and-hamcrest/"><meta property="og:title" content="Diff Excel with Java and Hamcrest"><meta property="og:description" content="Compare Excel spreadsheets in Java tests using Hamcrest matchers and Apache POI. The simple-excel library makes asserting on spreadsheet content straightforward."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2012-09-14-diff-excel-with-java-and-hamcrest/"><meta property="twitter:title" content="Diff Excel with Java and Hamcrest"><meta property="twitter:description" content="Compare Excel spreadsheets in Java tests using Hamcrest matchers and Apache POI. The simple-excel library makes asserting on spreadsheet content straightforward."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Diff Excel with Java and Hamcrest","description":"Compare Excel spreadsheets in Java tests using Hamcrest matchers and Apache POI. The simple-excel library makes asserting on spreadsheet content straightforward.","datePublished":"2012-09-14T00:00:00.000Z","url":"https://baddotrobot.com/blog/2012-09-14-diff-excel-with-java-and-hamcrest/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.CzF6U4o9.css">
<link rel="stylesheet" href="/_astro/_slug_.DbZHOt6G.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <!--{heroImage && (--> <!--  <div class="hero-image mb-8">--> <!--    <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-lg" />--> <!--  </div>--> <!--)}--> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">Diff Excel with Java and Hamcrest</h1>  <p class="article-description">Compare Excel spreadsheets in Java tests using Hamcrest matchers and Apache POI. The simple-excel library makes asserting on spreadsheet content straightforward.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2012-09-14T00:00:00.000Z"> Sep 14, 2012 </time> </div>  </div> <div class="prose">  <p>Comparing Excel spreadsheets programmatically can be tricky. Projects like <a href="http://poi.apache.org/">Apache POI</a> and <a href="http://jexcelapi.sourceforge.net/">JExcel</a> let you build and interrogate sheets but don’t offer a built in compare function. Fortunately, <a href="http://github.com/tobyweston/simple-excel">simple-excel</a> offers a simplified API for building sheets in Java and a bunch of <a href="http://hamcrest.org/">Hamcrest</a> matchers to find any differences.</p>
<h2 id="building-spreadsheets">Building Spreadsheets</h2>
<p><a href="http://github.com/tobyweston/simple-excel">Simple-excel</a> takes a sheet as a template and allows you to apply changes programmatically to it. For example, you can start with a blank invoice sheet and insert items and totals from your Java code. It wraps Apache POI to make things easier to work with.</p>
<p>However you create your sheet, it’d be nice to be able to unit test it. <a href="http://github.com/tobyweston/simple-excel">Simple-excel</a> offers <code>Matcher</code>s to do just that. You can write unit style tests, making assertions against individual cells or rows or you can write coarser grained tests that compare every cell of one sheet against every cell of another.</p>
<h2 id="matchers">Matchers</h2>
<p>The matchers you’re most likely to use can be found in the <code>bad.robot.excel.matchers.Matchers</code> class. They include <code>WorkbookMatcher</code> and <code>CellMatcher</code> but there are a bunch of finer grained matchers in the <code>bad.robot.excel.matchers</code> package.</p>
<h2 id="comparing-sheets">Comparing Sheets</h2>
<p>Using the <code>WorkbookMatcher</code>, you can compare an entire workbook to another. The comparison is made against POI <code>Workbook</code> objects, so load these using POI.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">Workbook actual </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> HSSFWorkbook</span><span style="color:#E1E4E8">(...);</span></span>
<span class="line"><span style="color:#E1E4E8">Workbook expected </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> HSSFWorkbook</span><span style="color:#E1E4E8">(...);</span></span>
<span class="line"><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(actual, </span><span style="color:#B392F0">sameWorkbook</span><span style="color:#E1E4E8">(expected));</span></span></code></pre>
<p>If you use the <code>MatcherAssert.assertThat</code> from Hamcrest rather than the vanilla JUnit version (<code>org.junit.Assert.assertThat</code>), you’ll see useful information on a failure.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>java.lang.AssertionError:</span></span>
<span class="line"><span>Expected: entire workbook to be equal</span></span>
<span class="line"><span>     but: cell at "C14" contained &#x3C;"bananas"> expected &#x3C;nothing>,</span></span>
<span class="line"><span>          cell at "C15" contained &#x3C;"£1,850,000"> expected &#x3C;"£1,850,000.00">,</span></span>
<span class="line"><span>          cell at "D16" contained &#x3C;nothing> expected &#x3C;"Tue Sep 04 06:30:00"></span></span></code></pre>
<p>Other failures might include differing number of sheets, differently named sheets, different number of rows or columns. They’re all aggregated in the failure message so you don’t need to fix one and run the test again. It’ll try and report all errors up front.</p>
<h2 id="finer-grained-comparisons">Finer Grained Comparisons</h2>
<p>Lets say we have a class, <code>InvoiceItem</code> representing a sale item. We’d like to append this line item as a row on an invoice. It might look something like this.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">InputStream template </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">getClass</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getResourceAsStream</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"invoiceTemplate.xls"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">Workbook invoice </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> HSSFWorkbook</span><span style="color:#E1E4E8">(template);</span></span>
<span class="line"><span style="color:#E1E4E8">InvoiceItem item </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> InvoiceItem</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">item.</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">(invoice);</span></span></code></pre>
<p>The <code>appendTo</code> method uses <a href="http://github.com/tobyweston/simple-excel">simple-excel</a> to append the row to the invoice (ignore the details for now) but we’d like to verify that the sheet has been modified in the right way. Using the <code>CellMatcher</code>, you can do something like this.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getCellForCoordinate</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">coordinate</span><span style="color:#E1E4E8">(E, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), invoice), </span><span style="color:#B392F0">is</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">equalTo</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">stringCell</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Mac Book Pro"</span><span style="color:#E1E4E8">))));</span></span>
<span class="line"><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getCellForCoordinate</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">coordinate</span><span style="color:#E1E4E8">(E, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">), invoice), </span><span style="color:#B392F0">is</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">equalTo</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">numberCell</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">999.99D</span><span style="color:#E1E4E8">))));</span></span>
<span class="line"><span style="color:#B392F0">assertThat</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getCellForCoordinate</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">coordinate</span><span style="color:#E1E4E8">(E, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">), invoice), </span><span style="color:#B392F0">is</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">equalTo</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">blankCell</span><span style="color:#E1E4E8">()));</span></span></code></pre>
<p>Where the <code>getCellForCoordinate</code> returns a POI <code>Cell</code> object and <code>equalTo</code> is statically imported from <code>bad.robot.excel.matchers.Matchers</code> (not regular Hamcrest <code>equalTo</code>);</p>
<p>When it fails, you’ll get something friendly like this;</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>java.lang.AssertionError:</span></span>
<span class="line"><span>Expected: is &#x3C;999.99D></span></span>
<span class="line"><span>	 but: cell at "E2" contained &#x3C;1999.99D> expected &#x3C;999.99D></span></span></code></pre>
<p>It matches on type and content of the cell. So the string cell <code>"999.99"</code> is different than the numeric cell <code>999.99</code>. It doesn’t yet match against styling (things like borders or background colours).</p>
<p>The project is open source. As always, I’d love to hear how you get on using it. Check it out and the leave a comment if you like it. Issues are tracked on the <a href="http://github.com/tobyweston/simple-excel/issues">project site</a>.</p>
<h2 id="recommended-reading">Recommended Reading</h2>
<ul>
<li><a href="http://www.amazon.co.uk/gp/product/0321503627/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=0321503627&#x26;linkCode=as2&#x26;tag=baddotrobot-21">Growing Object-Oriented Software, Guided by Tests</a>, Steve Freeman, Nat Pryce</li>
<li><a href="http://www.amazon.co.uk/gp/product/839348930X/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=839348930X&#x26;linkCode=as2&#x26;tag=baddotrobot-21">Practical Unit Testing with TestNG and Mockito</a>, Tomek Kaczanowski</li>
<li><a href="http://www.amazon.co.uk/gp/product/0321784154/ref=as_li_ss_tl?ie=UTF8&#x26;camp=1634&#x26;creative=19450&#x26;creativeASIN=0321784154&#x26;linkCode=as2&#x26;tag=baddotrobot-21">ATDD by Example: A Practical Guide to Acceptance Test-driven Development</a>, Markus Gärtner</li>
</ul>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>