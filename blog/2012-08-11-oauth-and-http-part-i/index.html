<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.17.3"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1PVLDLDJQN"></script><script>(function(){const gaId = "G-1PVLDLDJQN";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    })();</script><!-- Canonical URL --><link rel="canonical" href="https://baddotrobot.com/blog/2012-08-11-oauth-and-http-part-i/"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="bad.robot" href="/rss.xml"><!-- Primary Meta Tags --><title>FreeAgent, OAuth &amp; HTTP (Part I)</title><meta name="title" content="FreeAgent, OAuth &#38; HTTP (Part I)"><meta name="description" content="OAuth and HTTP part I: understanding the OAuth authorisation flow. Covers the three-legged OAuth dance, tokens, and how to implement it in Java with Scribe."><meta name="keywords" content="OAuth, HTTP, authorisation, access token, OAuth flow, REST API security, Scribe, Java"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://baddotrobot.com/blog/2012-08-11-oauth-and-http-part-i/"><meta property="og:title" content="FreeAgent, OAuth &#38; HTTP (Part I)"><meta property="og:description" content="OAuth and HTTP part I: understanding the OAuth authorisation flow. Covers the three-legged OAuth dance, tokens, and how to implement it in Java with Scribe."><meta property="og:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><meta property="og:site_name" content="bad.robot"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://baddotrobot.com/blog/2012-08-11-oauth-and-http-part-i/"><meta property="twitter:title" content="FreeAgent, OAuth &#38; HTTP (Part I)"><meta property="twitter:description" content="OAuth and HTTP part I: understanding the OAuth authorisation flow. Covers the three-legged OAuth dance, tokens, and how to implement it in Java with Scribe."><meta property="twitter:image" content="https://baddotrobot.com/images/heroes/java-code.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"FreeAgent, OAuth & HTTP (Part I)","description":"OAuth and HTTP part I: understanding the OAuth authorisation flow. Covers the three-legged OAuth dance, tokens, and how to implement it in Java with Scribe.","datePublished":"2012-08-11T00:00:00.000Z","image":"https://baddotrobot.com/images/heroes/database.jpg","url":"https://baddotrobot.com/blog/2012-08-11-oauth-and-http-part-i/","author":{"@type":"Person","name":"Toby Weston","url":"https://baddotrobot.com"},"publisher":{"@type":"Person","name":"bad.robot"}}</script><link rel="stylesheet" href="/_astro/index.CzF6U4o9.css">
<link rel="stylesheet" href="/_astro/_slug_.DbZHOt6G.css"></head> <body class="bg-white text-gray-900"> <header class="header" data-astro-cid-3ef6ksr2> <div class="header-container" data-astro-cid-3ef6ksr2> <div class="logo-section" data-astro-cid-3ef6ksr2> <a href="/" class="logo-link" data-astro-cid-3ef6ksr2> <img src="/_astro/robot-logo_105x132.N1ZQY9mA_Zj02tT.webp" alt="bad.robot logo" data-astro-cid-3ef6ksr2="true" loading="lazy" decoding="async" fetchpriority="auto" width="84" height="106" class="logo-image"> <div class="logo-text-block" data-astro-cid-3ef6ksr2> <h1 class="logo-title logo-text header-logo-text" data-astro-cid-3ef6ksr2>bad.robot</h1> <h2 class="logo-subtitle logo-subtitle-text header-subtitle" data-astro-cid-3ef6ksr2>good robots do what they&#39;re told</h2> </div> </a> </div> <nav class="nav" data-astro-cid-3ef6ksr2> <a href="/blog" data-astro-cid-3ef6ksr2>Blog</a> <a href="/book" data-astro-cid-3ef6ksr2>Books</a> <a href="/video" data-astro-cid-3ef6ksr2>Videos</a> <a href="/archive" data-astro-cid-3ef6ksr2>Archive</a> </nav> </div> </header>  <main id="site-main" class="mx-auto w-full max-w-6xl px-4 pt-4">   <div class="py-12"> <article class=""> <!--{heroImage && (--> <!--  <div class="hero-image mb-8">--> <!--    <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-lg" />--> <!--  </div>--> <!--)}--> <div class="article-title-section mb-8"> <p class="detail-kicker">Blog</p> <h1 class="article-title-section h1">FreeAgent, OAuth &amp; HTTP (Part I)</h1> <p class="article-subtitle">Implement OAuth authorization in your desktop Java applications</p> <p class="article-description">OAuth and HTTP part I: understanding the OAuth authorisation flow. Covers the three-legged OAuth dance, tokens, and how to implement it in Java with Scribe.</p> </div> <div class="article-meta"> <div class="article-date"> <strong>Published:</strong> <time datetime="2012-08-11T00:00:00.000Z"> Aug 11, 2012 </time> </div>  </div> <div class="prose">  <p>Although OAuth is intended for web, mobile and desktop applications, I’ve been finding the protocol clunky when accessing a web application from a rich desktop client. Specifically, I’m trying to access FreeAgent’s API. Their <a href="https://dev.freeagent.com/docs/oauth">documentation is pretty thin</a> on background. The <a href="https://groups.google.com/forum/#!forum/freeagent_api">support</a> is fairly focused on web apps and I found it difficult getting a desktop client hooked up.</p>
<p>As a result, I’m journaling my experiences and hopefully learning a thing or two about OAuth along the way.</p>
<h2 id="oauth">OAuth</h2>
<p><a href="http://www.oauth.net">OAuth</a> is described as “an open protocol to allow secure authorisation from web, mobile and desktop applications”. It’s intended as a handshaking protocol whereby an application is granted authorisation to another without having to know the target application’s user credentials. The application requesting access never knows the end users details.</p>
<p>It’s probably best described in terms of it’s typical <a href="http://hueniverse.com/oauth/guide/workflow/">workflow</a>.</p>
<h2 id="authorisation-request">Authorisation Request</h2>
<p>Once you have an application <em>client id</em> and <em>client secret</em>, you can request an <em>authorisation code</em>. This affectively means you’re application is asking the target application for authorisation and to remember that your application is a valid “user”. In API terms, it means you’re asking for authorised access to the target’s API.</p>
<p>A <code>GET</code> is made to the target <em>authorisation endpoint</em> with the <em>client id</em> and a <em>redirect URL</em> in the query string.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">GET</span><span style="color:#9ECBFF"> https://api.freeagent.com/v2/approve_app?redirect_uri=XXX</span><span style="color:#E1E4E8">&#x26;response_type</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">code</span><span style="color:#E1E4E8">&#x26;client_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">YYY</span><span style="color:#B392F0"> HTTP/1.1</span></span></code></pre>
<p>The <a href="https://dev.freeagent.com/docs/oauth">FreeAgent documentation</a> talks about your application making this request but it really needs to be done in a browser environment. Fine, if your application is a web app. Not fine, if you’re trying to programmatically do the HTTP <code>GET</code> request. At least, things got complicated for me when I tried.</p>
<p>If you do make the request in a browser environment, you’ll log into FreeAgent with your user account and be asked to authorise the client application.</p>
<p><img alt="Authorisation confirmation" loading="lazy" decoding="async" fetchpriority="auto" width="855" height="622" src="/_astro/freeagent_auth_confirmation.1qnYLPaE_1fORsf.webp" ></p>
<p>At this point, FreeAgent will redirect to the <em>redirect URL</em> you supplied with the authorisation request. This is where it gets clunky. For a desktop application, where should you redirect to? The protocol causes tension because it requires a HTTP endpoint. Up and till now, it’s only required a HTTP <em>client</em>, not a running <em>server</em>.</p>
<p>There is an “out of band” option in the OAuth specification. Using this, you would supply the query parameter <code>oauth_callback=oob</code> instead of a <code>redirect_url</code>. In this case, you’ll be redirected to a page maintained by the target application (FreeAgent in our example) where the authorisation code is displayed for you to copy. Unfortunately, FreeAgent <a href="https://groups.google.com/forum/?fromgroups#!topic/freeagent_api/Rbld9sm0GOA">don’t support this</a> “out of band” option.</p>
<h2 id="fake-oob">Fake OOB</h2>
<p>In lieu of this, I resorted to firing up a temporary HTTP server to reproduce the affect. The server runs on <code>localhost:8088/oauth</code> for example, and will extract the code from the response to the original authorisation request. If you set the <code>redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth</code>, the request will be redirected here after you’ve manually confirmed authorisation in the browser. Crucially, it will pass along the <em>authorisation code</em> in the URL.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">http://localhost:8080/oauth?code</span><span style="color:#9ECBFF">=1A18cTY2tK7_ZHUsYSknCVWbVRYB4Nk</span></span></code></pre>
<p>All that’s left to do is extract it programmatically or display it for some cut and paste action. In my spoofed “out of band” workflow, it looks like this.</p>
<p><img alt="OOB Spoof" loading="lazy" decoding="async" fetchpriority="auto" width="855" height="622" src="/_astro/freeagent_oob_spoof.CFbITm6m_ZFlAed.webp" ></p>
<p>At this point, you’re application is now authorised to access the target. Jumping into my FreeAgent account, I can see this to be the case. The FreeAgent documentation doesn’t make it very clear when it says the next step happens “out of band”, but once you’ve got your authorisation code, it’ll be valid for a while. You don’t need to go through this step every time your application uses the target API.</p>
<p><img alt="My app is authorised" loading="lazy" decoding="async" fetchpriority="auto" width="855" height="622" src="/_astro/freeagent_authorised.B-Go1Xqn_LRRBc.webp" ></p>
<h2 id="next-up">Next Up</h2>
<p>Once you’ve got the <em>authorisation code</em> but before actually being able to access target resources, you need to exchange the code for an <em>access token</em>.</p>
<p>I think that’s quiet enough for now though, so we’ll take a look at how that’s done in the <a href="/blog/2012-08-12-oauth-and-http-part-ii">next post</a>.</p>  </div> </article> </div>  </main> <footer class="py-8 border-t border-gray-200 mt-12"> <div class="container mx-auto px-4 text-center"> <p class="text-xs text-gray-600">&copy; 2008-2026 Toby Weston. All rights reserved. (see some old <a class="text-gray-600 hover:text-sky-600" href="/code/">code</a>)</p> </div> </footer> </body></html>